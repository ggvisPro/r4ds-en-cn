<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hadley Wickham, Mine Çetinkaya-Rundel, and Garrett Grolemund">
<title>28&nbsp; Quarto – R 数据科学 2e</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./quarto-formats.html" rel="next">
<link href="./communicate.html" rel="prev">
<link href="./cover.jpg" rel="icon" type="image/jpeg">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-cfa698a38273543b64ee69d493127e2a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script defer="" data-domain="r4ds.hadley.nz" src="https://plausible.io/js/plausible.js"></script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./communicate.html">沟通</a></li><li class="breadcrumb-item"><a href="./quarto.html"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Quarto</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R 数据科学 2e</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ggvisPro/r4ds-cn/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface-2e.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface to the second edition</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Whole game</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-visualize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Data visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Workflow: basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data transformation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-style.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Workflow: code style</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data tidying</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Workflow: scripts and projects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data import</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Workflow: getting help</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./visualize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualize</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./layers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Layers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Communication</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">数据转换</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logicals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">逻辑向量</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">数值</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">字符串</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regexps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">正则表达式</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">因子</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datetimes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">日期和时间</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missing-values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">缺失值</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">连接</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">导入</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spreadsheets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">电子表格</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./databases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">数据库</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./arrow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Arrow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rectangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">层级数据</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./webscraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">网络抓取</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./program.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">编程</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">函数</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iteration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">迭代</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./base-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Base R 实战指南</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./communicate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">沟通</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto-formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Quarto 格式</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#%E5%BC%95%E8%A8%80" id="toc-引言" class="nav-link active" data-scroll-target="#%E5%BC%95%E8%A8%80"><span class="header-section-number">28.1</span> 引言</a>
  <ul class="collapse">
<li><a href="#%E5%85%88%E5%86%B3%E6%9D%A1%E4%BB%B6" id="toc-先决条件" class="nav-link" data-scroll-target="#%E5%85%88%E5%86%B3%E6%9D%A1%E4%BB%B6"><span class="header-section-number">28.1.1</span> 先决条件</a></li>
  </ul>
</li>
  <li>
<a href="#quarto-%E5%9F%BA%E7%A1%80" id="toc-quarto-基础" class="nav-link" data-scroll-target="#quarto-%E5%9F%BA%E7%A1%80"><span class="header-section-number">28.2</span> Quarto 基础</a>
  <ul class="collapse">
<li><a href="#%E7%BB%83%E4%B9%A0" id="toc-练习" class="nav-link" data-scroll-target="#%E7%BB%83%E4%B9%A0"><span class="header-section-number">28.2.1</span> 练习</a></li>
  </ul>
</li>
  <li>
<a href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E7%BC%96%E8%BE%91%E5%99%A8" id="toc-可视化编辑器" class="nav-link" data-scroll-target="#%E5%8F%AF%E8%A7%86%E5%8C%96%E7%BC%96%E8%BE%91%E5%99%A8"><span class="header-section-number">28.3</span> 可视化编辑器</a>
  <ul class="collapse">
<li><a href="#%E7%BB%83%E4%B9%A0-1" id="toc-练习-1" class="nav-link" data-scroll-target="#%E7%BB%83%E4%B9%A0-1"><span class="header-section-number">28.3.1</span> 练习</a></li>
  </ul>
</li>
  <li>
<a href="#sec-source-editor" id="toc-sec-source-editor" class="nav-link" data-scroll-target="#sec-source-editor"><span class="header-section-number">28.4</span> 源代码编辑器</a>
  <ul class="collapse">
<li><a href="#%E7%BB%83%E4%B9%A0-2" id="toc-练习-2" class="nav-link" data-scroll-target="#%E7%BB%83%E4%B9%A0-2"><span class="header-section-number">28.4.1</span> 练习</a></li>
  </ul>
</li>
  <li>
<a href="#%E4%BB%A3%E7%A0%81%E5%9D%97" id="toc-代码块" class="nav-link" data-scroll-target="#%E4%BB%A3%E7%A0%81%E5%9D%97"><span class="header-section-number">28.5</span> 代码块</a>
  <ul class="collapse">
<li><a href="#%E4%BB%A3%E7%A0%81%E5%9D%97%E6%A0%87%E7%AD%BE" id="toc-代码块标签" class="nav-link" data-scroll-target="#%E4%BB%A3%E7%A0%81%E5%9D%97%E6%A0%87%E7%AD%BE"><span class="header-section-number">28.5.1</span> 代码块标签</a></li>
  <li><a href="#%E4%BB%A3%E7%A0%81%E5%9D%97%E9%80%89%E9%A1%B9" id="toc-代码块选项" class="nav-link" data-scroll-target="#%E4%BB%A3%E7%A0%81%E5%9D%97%E9%80%89%E9%A1%B9"><span class="header-section-number">28.5.2</span> 代码块选项</a></li>
  <li><a href="#%E5%85%A8%E5%B1%80%E9%80%89%E9%A1%B9" id="toc-全局选项" class="nav-link" data-scroll-target="#%E5%85%A8%E5%B1%80%E9%80%89%E9%A1%B9"><span class="header-section-number">28.5.3</span> 全局选项</a></li>
  <li><a href="#%E5%86%85%E8%81%94%E4%BB%A3%E7%A0%81" id="toc-内联代码" class="nav-link" data-scroll-target="#%E5%86%85%E8%81%94%E4%BB%A3%E7%A0%81"><span class="header-section-number">28.5.4</span> 内联代码</a></li>
  <li><a href="#%E7%BB%83%E4%B9%A0-3" id="toc-练习-3" class="nav-link" data-scroll-target="#%E7%BB%83%E4%B9%A0-3"><span class="header-section-number">28.5.5</span> 练习</a></li>
  </ul>
</li>
  <li>
<a href="#sec-figures" id="toc-sec-figures" class="nav-link" data-scroll-target="#sec-figures"><span class="header-section-number">28.6</span> 图形</a>
  <ul class="collapse">
<li><a href="#%E5%9B%BE%E5%BD%A2%E5%B0%BA%E5%AF%B8" id="toc-图形尺寸" class="nav-link" data-scroll-target="#%E5%9B%BE%E5%BD%A2%E5%B0%BA%E5%AF%B8"><span class="header-section-number">28.6.1</span> 图形尺寸</a></li>
  <li><a href="#%E5%85%B6%E4%BB%96%E9%87%8D%E8%A6%81%E9%80%89%E9%A1%B9" id="toc-其他重要选项" class="nav-link" data-scroll-target="#%E5%85%B6%E4%BB%96%E9%87%8D%E8%A6%81%E9%80%89%E9%A1%B9"><span class="header-section-number">28.6.2</span> 其他重要选项</a></li>
  <li><a href="#%E7%BB%83%E4%B9%A0-4" id="toc-练习-4" class="nav-link" data-scroll-target="#%E7%BB%83%E4%B9%A0-4"><span class="header-section-number">28.6.3</span> 练习</a></li>
  </ul>
</li>
  <li>
<a href="#%E8%A1%A8%E6%A0%BC" id="toc-表格" class="nav-link" data-scroll-target="#%E8%A1%A8%E6%A0%BC"><span class="header-section-number">28.7</span> 表格</a>
  <ul class="collapse">
<li><a href="#%E7%BB%83%E4%B9%A0-5" id="toc-练习-5" class="nav-link" data-scroll-target="#%E7%BB%83%E4%B9%A0-5"><span class="header-section-number">28.7.1</span> 练习</a></li>
  </ul>
</li>
  <li>
<a href="#sec-caching" id="toc-sec-caching" class="nav-link" data-scroll-target="#sec-caching"><span class="header-section-number">28.8</span> 缓存</a>
  <ul class="collapse">
<li><a href="#%E7%BB%83%E4%B9%A0-6" id="toc-练习-6" class="nav-link" data-scroll-target="#%E7%BB%83%E4%B9%A0-6"><span class="header-section-number">28.8.1</span> 练习</a></li>
  </ul>
</li>
  <li><a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4" id="toc-故障排除" class="nav-link" data-scroll-target="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4"><span class="header-section-number">28.9</span> 故障排除</a></li>
  <li>
<a href="#yaml-%E6%A0%87%E5%A4%B4" id="toc-yaml-标头" class="nav-link" data-scroll-target="#yaml-%E6%A0%87%E5%A4%B4"><span class="header-section-number">28.10</span> YAML 标头</a>
  <ul class="collapse">
<li><a href="#%E8%87%AA%E5%8C%85%E5%90%AB" id="toc-自包含" class="nav-link" data-scroll-target="#%E8%87%AA%E5%8C%85%E5%90%AB"><span class="header-section-number">28.10.1</span> 自包含</a></li>
  <li><a href="#%E5%8F%82%E6%95%B0" id="toc-参数" class="nav-link" data-scroll-target="#%E5%8F%82%E6%95%B0"><span class="header-section-number">28.10.2</span> 参数</a></li>
  <li><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%E5%92%8C%E5%BC%95%E6%96%87" id="toc-参考文献和引文" class="nav-link" data-scroll-target="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%E5%92%8C%E5%BC%95%E6%96%87"><span class="header-section-number">28.10.3</span> 参考文献和引文</a></li>
  </ul>
</li>
  <li><a href="#%E5%B7%A5%E4%BD%9C%E6%B5%81" id="toc-工作流" class="nav-link" data-scroll-target="#%E5%B7%A5%E4%BD%9C%E6%B5%81"><span class="header-section-number">28.11</span> 工作流</a></li>
  <li><a href="#%E6%80%BB%E7%BB%93" id="toc-总结" class="nav-link" data-scroll-target="#%E6%80%BB%E7%BB%93"><span class="header-section-number">28.12</span> 总结</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/ggvisPro/r4ds-cn/edit/main/quarto.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ggvisPro/r4ds-cn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./communicate.html">沟通</a></li><li class="breadcrumb-item"><a href="./quarto.html"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Quarto</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-quarto" class="quarto-section-identifier"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Quarto</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="引言" class="level2" data-number="28.1"><h2 data-number="28.1" class="anchored" data-anchor-id="引言">
<span class="header-section-number">28.1</span> 引言</h2>
<p>Quarto 为数据科学提供了一个统一的创作框架，它将你的代码、代码的运行结果以及你的文字说明整合在一起。Quarto 文档是完全可复现的，并支持数十种输出格式，如 PDF、Word 文件、演示文稿等。</p>
<p>Quarto 文件旨在以三种方式使用：</p>
<ol type="1">
<li><p>用于与决策者沟通，他们希望关注结论，而不是分析背后的代码。</p></li>
<li><p>用于与其他数据科学家（包括未来的你！）协作，他们既对你的结论感兴趣，也对你如何得出结论（即代码）感兴趣。</p></li>
<li><p>作为一种<em>从事</em>数据科学的环境，如同现代的实验笔记，你不仅可以记录你做了什么，还可以记录你的所思所想。</p></li>
</ol>
<p>Quarto 是一个命令行界面工具，而不是一个 R 包。这意味着，总的来说，你无法通过 <code>?</code> 来获取帮助。因此，在本章的学习过程中以及将来使用 Quarto 时，你应该参考 <a href="https://quarto.org">Quarto 文档</a>。</p>
<p>如果你是 R Markdown 用户，你可能会想：“Quarto 听起来很像 R Markdown”。你没说错！Quarto 将 R Markdown 生态系统中的许多包（rmarkdown、bookdown、distill、xaringan 等）的功能统一到一个单一、一致的系统中，并且除了 R 之外，还扩展了对 Python 和 Julia 等多种编程语言的原生支持。从某种意义上说，Quarto 体现了十多年来扩展和支持 R Markdown 生TAI系统所学到的一切。</p>
<section id="先决条件" class="level3" data-number="28.1.1"><h3 data-number="28.1.1" class="anchored" data-anchor-id="先决条件">
<span class="header-section-number">28.1.1</span> 先决条件</h3>
<p>你需要 Quarto 命令行界面 (Quarto CLI)，但你不需要显式地安装或加载它，因为 RStudio 会在需要时自动完成这两项工作。</p>
</section></section><section id="quarto-基础" class="level2" data-number="28.2"><h2 data-number="28.2" class="anchored" data-anchor-id="quarto-基础">
<span class="header-section-number">28.2</span> Quarto 基础</h2>
<p>这是一个 Quarto 文件——一个扩展名为 <code>.qmd</code> 的纯文本文件：</p>
<div class="cell">
<pre><code>---
title: "Diamond sizes"
date: 2022-09-12
format: html
---

```{r}
#| label: setup
#| include: false

library(tidyverse)

smaller &lt;- diamonds |&gt; 
  filter(carat &lt;= 2.5)
```

We have data about `r nrow(diamonds)` diamonds.
Only `r nrow(diamonds) - nrow(smaller)` are larger than 2.5 carats.
The distribution of the remainder is shown below:

```{r}
#| label: plot-smaller-diamonds
#| echo: false

smaller |&gt; 
  ggplot(aes(x = carat)) + 
  geom_freqpoly(binwidth = 0.01)
```</code></pre>
</div>
<p>它包含三种重要的内容类型：</p>
<ol type="1">
<li>一个（可选的）由 <code>---</code> 包围的 <strong>YAML 标头</strong>。</li>
<li>由 <code>```</code> 包围的 R <strong>代码块</strong> (chunks)。</li>
<li>混合了简单文本格式的文本，如 <code># 标题</code> 和 <code>_斜体_</code>。</li>
</ol>
<p><a href="#fig-diamond-sizes-notebook" class="quarto-xref">Figure&nbsp;<span>28.1</span></a> 展示了 RStudio 中一个 <code>.qmd</code> 文档的笔记本界面，其中代码和输出交错显示。你可以通过点击代码块顶部的运行图标（看起来像一个播放按钮），或按 Cmd/Ctrl + Shift + Enter 来运行每个代码块。RStudio 会执行代码并将结果内联显示在代码下方。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-diamond-sizes-notebook" class="quarto-float quarto-figure quarto-figure-center anchored" alt="RStudio 窗口，左侧是名为 “diamond-sizes.qmd” 的 Quarto 文档， 右侧是空白的查看器窗口。Quarto 文档中有一个代码块， 用于创建重量小于 2.5 克拉的钻石的频率图。该图显示， 随着重量的增加，频率降低。">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diamond-sizes-notebook-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="quarto/diamond-sizes-notebook.png" class="img-fluid figure-img" style="width:90.0%" alt="RStudio 窗口，左侧是名为 “diamond-sizes.qmd” 的 Quarto 文档， 右侧是空白的查看器窗口。Quarto 文档中有一个代码块， 用于创建重量小于 2.5 克拉的钻石的频率图。该图显示， 随着重量的增加，频率降低。">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diamond-sizes-notebook-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;28.1: RStudio 中的一个 Quarto 文档。代码和输出在文档中交错显示， 绘图输出直接出现在代码下方。
</figcaption></figure>
</div>
</div>
</div>
<p>如果你不喜欢在文档中看到你的绘图和输出，而更愿意使用 RStudio 的控制台和绘图窗格，你可以点击“Render”旁边的齿轮图标，然后切换到“Chunk Output in Console”，如 <a href="#fig-diamond-sizes-console-output" class="quarto-xref">Figure&nbsp;<span>28.2</span></a> 所示。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-diamond-sizes-console-output" class="quarto-float quarto-figure quarto-figure-center anchored" alt="RStudio 窗口，左侧是名为 &quot;diamond-sizes.qmd&quot; 的 Quarto 文档， 右下角是“绘图”窗格。Quarto 文档中有一个代码块， 用于创建重量小于 2.5 克拉的钻石的频率图。 该图显示在“绘图”窗格中，并显示随着重量的增加，频率降低。 RStudio 中“在控制台中显示代码块输出”的选项也被高亮显示。">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diamond-sizes-console-output-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="quarto/diamond-sizes-console-output.png" class="img-fluid figure-img" style="width:90.0%" alt="RStudio 窗口，左侧是名为 &quot;diamond-sizes.qmd&quot; 的 Quarto 文档， 右下角是“绘图”窗格。Quarto 文档中有一个代码块， 用于创建重量小于 2.5 克拉的钻石的频率图。 该图显示在“绘图”窗格中，并显示随着重量的增加，频率降低。 RStudio 中“在控制台中显示代码块输出”的选项也被高亮显示。">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diamond-sizes-console-output-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;28.2: RStudio 中的一个 Quarto 文档，绘图输出显示在“绘图”窗格中。
</figcaption></figure>
</div>
</div>
</div>
<p>要生成包含所有文本、代码和结果的完整报告，请点击“Render”或按 Cmd/Ctrl + Shift + K。你也可以通过 <code>quarto::quarto_render("diamond-sizes.qmd")</code> 以编程方式执行此操作。这将在查看器窗格中显示报告，如 <a href="#fig-diamond-sizes-report" class="quarto-xref">Figure&nbsp;<span>28.3</span></a> 所示，并创建一个 HTML 文件。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-diamond-sizes-report" class="quarto-float quarto-figure quarto-figure-center anchored" alt="RStudio 窗口，左侧是名为 “diamond-sizes.qmd” 的 Quarto 文档， 右下角是“绘图”窗格。渲染后的文档不显示任何代码， 但代码在源文档中是可见的。">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diamond-sizes-report-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="quarto/diamond-sizes-report.png" class="img-fluid figure-img" style="width:90.0%" alt="RStudio 窗口，左侧是名为 “diamond-sizes.qmd” 的 Quarto 文档， 右下角是“绘图”窗格。渲染后的文档不显示任何代码， 但代码在源文档中是可见的。">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diamond-sizes-report-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;28.3: RStudio 中的一个 Quarto 文档，渲染后的文档显示在“查看器”窗格中。
</figcaption></figure>
</div>
</div>
</div>
<p>当你渲染文档时，Quarto 会将 <code>.qmd</code> 文件发送给 <strong>knitr</strong>，<a href="https://yihui.org/knitr/">https://yihui.org/knitr/</a>，它会执行所有的代码块，并创建一个新的 markdown (<code>.md</code>) 文档，其中包含代码及其输出。然后，knitr 生成的 markdown 文件由 <strong>pandoc</strong>，<a href="https://pandoc.org/" class="uri">https://pandoc.org</a> 处理，它负责创建最终的文件。这个过程如 <a href="#fig-quarto-flow" class="quarto-xref">Figure&nbsp;<span>28.4</span></a> 所示。这种两步工作流的优点是，你可以创建非常广泛的输出格式，你将在 <a href="quarto-formats.html" class="quarto-xref"><span>Chapter 29</span></a> 中了解到这一点。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-quarto-flow" class="quarto-float quarto-figure quarto-figure-center anchored" alt="工作流图，从 qmd 文件开始，然后是 knitr，然后是 md， 然后是 pandoc，最后是 PDF、MS Word 或 HTML。 ">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-quarto-flow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/quarto-flow.png" class="img-fluid figure-img" style="width:75.0%" alt="工作流图，从 qmd 文件开始，然后是 knitr，然后是 md， 然后是 pandoc，最后是 PDF、MS Word 或 HTML。 ">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-quarto-flow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;28.4: Quarto 工作流图，从 qmd，到 knitr，到 md，到 pandoc， 最后输出为 PDF、MS Word 或 HTML 格式。
</figcaption></figure>
</div>
</div>
</div>
<p>要开始使用你自己的 <code>.qmd</code> 文件，请在菜单栏中选择 <em>File &gt; New File &gt; Quarto Document…</em>。RStudio 将启动一个向导，你可以用它来预填充你的文件，其中包含有用的内容，提醒你 Quarto 的关键功能是如何工作的。</p>
<p>接下来的部分将更详细地探讨 Quarto 文档的三个组成部分：markdown 文本、代码块和 YAML 标头。</p>
<section id="练习" class="level3" data-number="28.2.1"><h3 data-number="28.2.1" class="anchored" data-anchor-id="练习">
<span class="header-section-number">28.2.1</span> 练习</h3>
<ol type="1">
<li><p>使用 <em>File &gt; New File &gt; Quarto Document</em> 创建一个新的 Quarto 文档。阅读说明。练习单独运行代码块。然后通过点击相应的按钮和使用相应的键盘快捷键来渲染文档。验证你可以修改代码，重新运行它，并看到修改后的输出。</p></li>
<li><p>为三种内置格式中的每一种创建一个新的 Quarto 文档：HTML、PDF 和 Word。渲染这三个文档。输出有何不同？输入有何不同？（你可能需要安装 LaTeX 才能构建 PDF 输出——如果需要，RStudio 会提示你。）</p></li>
</ol></section></section><section id="可视化编辑器" class="level2" data-number="28.3"><h2 data-number="28.3" class="anchored" data-anchor-id="可视化编辑器">
<span class="header-section-number">28.3</span> 可视化编辑器</h2>
<p>RStudio 中的可视化编辑器为创作 Quarto 文档提供了一个 <a href="https://en.wikipedia.org/wiki/WYSIWYM">WYSIWYM</a> (所见即所想，What You See Is What You Mean) 界面。在底层，Quarto 文档（<code>.qmd</code> 文件）中的文字是使用 Markdown 编写的，这是一种用于格式化纯文本文件的轻量级约定。事实上，Quarto 使用的是 Pandoc markdown（Quarto 能理解的一种轻微扩展的 Markdown 版本），包括表格、引文、交叉引用、脚注、divs/spans、定义列表、属性、原始 HTML/TeX 等，并且支持执行代码单元格和内联查看其输出。虽然 Markdown 被设计得易于读写，正如你将在 <a href="#sec-source-editor" class="quarto-xref"><span>Section 28.4</span></a> 中看到的那样，它仍然需要学习新的语法。因此，如果你是计算文档（如 <code>.qmd</code> 文件）的新手，但有使用 Google Docs 或 MS Word 等工具的经验，那么在 RStudio 中开始使用 Quarto 的最简单方法就是使用可视化编辑器。</p>
<p>在可视化编辑器中，你可以使用菜单栏上的按钮插入图像、表格、交叉引用等，也可以使用通用的 &lt;kbd&gt;⌘&lt;/kbd&gt; + &lt;kbd&gt;/&lt;/kbd&gt; 或 &lt;kbd&gt;Ctrl&lt;/kbd&gt; + &lt;kbd&gt;/&lt;/kbd&gt; 快捷键插入几乎任何东西。如果你在一行的开头（如 <a href="#fig-visual-editor" class="quarto-xref">Figure&nbsp;<span>28.5</span></a> 所示），你也可以只输入 &lt;kbd&gt;/&lt;/kbd&gt; 来调用该快捷键。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-visual-editor" class="quarto-float quarto-figure quarto-figure-center anchored" alt="一个 Quarto 文档，展示了可视化编辑器的各种功能， 如文本格式（斜体、粗体、下划线、小型大写字母、代码、上标和下标）， 一级到三级标题，项目符号列表和编号列表，链接， 带链接的短语，以及图像（以及一个用于自定义图像大小、 添加标题和替代文本等的弹出窗口），带有标题行的表格， 以及“插入任何内容”工具，其选项包括插入 R 代码块、 Python 代码块、div、项目符号列表、编号列表或一级标题（工具中的前几个选项）。">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-visual-editor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="quarto/quarto-visual-editor.png" class="img-fluid figure-img" style="width:75.0%" alt="一个 Quarto 文档，展示了可视化编辑器的各种功能， 如文本格式（斜体、粗体、下划线、小型大写字母、代码、上标和下标）， 一级到三级标题，项目符号列表和编号列表，链接， 带链接的短语，以及图像（以及一个用于自定义图像大小、 添加标题和替代文本等的弹出窗口），带有标题行的表格， 以及“插入任何内容”工具，其选项包括插入 R 代码块、 Python 代码块、div、项目符号列表、编号列表或一级标题（工具中的前几个选项）。">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-visual-editor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;28.5: Quarto 可视化编辑器。
</figcaption></figure>
</div>
</div>
</div>
<p>可视化编辑器也方便了插入图像和自定义其显示方式。你可以直接将剪贴板中的图像粘贴到可视化编辑器中（RStudio 会将该图像的副本放置在项目目录中并链接到它），也可以使用可视化编辑器的“Insert &gt; Figure / Image”菜单浏览到要插入的图像或粘贴其 URL。此外，使用同一菜单，你可以调整图像大小，并添加标题、替代文本和链接。</p>
<p>可视化编辑器还有许多我们在此未列举的功能，随着你创作经验的增加，你可能会发现它们很有用。</p>
<p>最重要的是，虽然可视化编辑器以格式化的方式显示你的内容，但在底层，它以纯 Markdown 的形式保存你的内容，你可以在可视化编辑器和源代码编辑器之间来回切换，使用任一工具查看和编辑你的内容。</p>
<section id="练习-1" class="level3" data-number="28.3.1"><h3 data-number="28.3.1" class="anchored" data-anchor-id="练习-1">
<span class="header-section-number">28.3.1</span> 练习</h3>
<ol type="1">
<li>使用可视化编辑器重新创建 <a href="#fig-visual-editor" class="quarto-xref">Figure&nbsp;<span>28.5</span></a> 中的文档。</li>
<li>使用可视化编辑器，通过“Insert”菜单和“插入任何内容”工具插入一个代码块。</li>
<li>使用可视化编辑器，找出如何：
<ol type="a">
<li>添加脚注。</li>
<li>添加水平线。</li>
<li>添加块引用。</li>
</ol>
</li>
<li>在可视化编辑器中，进入“Insert &gt; Citation”，并使用其 DOI (数字对象标识符) <a href="https://doi.org/10.21105/joss.01686">10.21105/joss.01686</a> 插入一篇题为 <a href="https://joss.theoj.org/papers/10.21105/joss.01686">Welcome to the Tidyverse</a> 的论文的引文。渲染文档并观察引文在文档中的显示方式。你观察到文档的 YAML 有什么变化？</li>
</ol></section></section><section id="sec-source-editor" class="level2" data-number="28.4"><h2 data-number="28.4" class="anchored" data-anchor-id="sec-source-editor">
<span class="header-section-number">28.4</span> 源代码编辑器</h2>
<p>你也可以在没有可视化编辑器辅助的情况下，使用 RStudio 中的源代码编辑器来编辑 Quarto 文档。虽然可视化编辑器对于有使用 Google Docs 等工具写作经验的人来说会感到熟悉，但源代码编辑器对于有编写 R 脚本或 R Markdown 文档经验的人来说会感到熟悉。源代码编辑器对于调试任何 Quarto 语法错误也很有用，因为在纯文本中更容易发现这些错误。</p>
<p>以下指南展示了如何在源代码编辑器中使用 Pandoc 的 Markdown 来创作 Quarto 文档。</p>
<div class="cell">
<pre><code>## Text formatting

*italic* **bold** ~~strikeout~~ `code`

superscript^2^ subscript~2~

[underline]{.underline} [small caps]{.smallcaps}

## Headings

# 1st Level Header

## 2nd Level Header

### 3rd Level Header

## Lists

-   Bulleted list item 1

-   Item 2

    -   Item 2a

    -   Item 2b

1.  Numbered list item 1

2.  Item 2.
    The numbers are incremented automatically in the output.

## Links and images

&lt;http://example.com&gt;

[linked phrase](http://example.com)

![optional caption text](quarto.png){fig-alt="Quarto logo and the word quarto spelled in small case letters"}

## Tables

| First Header | Second Header |
|--------------|---------------|
| Content Cell | Content Cell  |
| Content Cell | Content Cell  |</code></pre>
</div>
<p>学习这些语法的最好方法就是亲手尝试。这可能需要几天时间，但很快它们就会成为你的第二天性，你将不再需要刻意去想它们。如果你忘记了，可以通过 <em>Help &gt; Markdown Quick Reference</em> 打开一个方便的参考表。</p>
<section id="练习-2" class="level3" data-number="28.4.1"><h3 data-number="28.4.1" class="anchored" data-anchor-id="练习-2">
<span class="header-section-number">28.4.1</span> 练习</h3>
<ol type="1">
<li><p>练习你所学的知识，创建一份简短的简历。标题应该是你的名字，并且你应该包含（至少）教育或工作经历的标题。每个部分都应该包含一个职位/学位的项目符号列表。用粗体突出显示年份。</p></li>
<li>
<p>使用源代码编辑器和 Markdown 快速参考，找出如何：</p>
<ol type="a">
<li>添加脚注。</li>
<li>添加水平线。</li>
<li>添加块引用。</li>
</ol>
</li>
<li><p>从 <a href="https://github.com/hadley/r4ds/tree/main/quarto">https://github.com/hadley/r4ds/tree/main/quarto</a> 复制 <code>diamond-sizes.qmd</code> 的内容并粘贴到本地的 R Quarto 文档中。检查你是否可以运行它，然后在频率多边形图后添加文本，描述其最显著的特征。</p></li>
<li><p>在 Google Doc 或 MS Word 中创建一个文档（或找到一个你以前创建的文档），其中包含一些内容，如标题、超链接、格式化文本等。复制此文档的内容并将其粘贴到可视化编辑器的 Quarto 文档中。然后，切换到源代码编辑器并检查源代码。</p></li>
</ol></section></section><section id="代码块" class="level2" data-number="28.5"><h2 data-number="28.5" class="anchored" data-anchor-id="代码块">
<span class="header-section-number">28.5</span> 代码块</h2>
<p>要在 Quarto 文档中运行代码，你需要插入一个代码块。有三种方法可以做到这一点：</p>
<ol type="1">
<li><p>键盘快捷键 Cmd + Option + I / Ctrl + Alt + I。</p></li>
<li><p>编辑器工具栏中的“Insert”按钮图标。</p></li>
<li><p>手动输入代码块分隔符 <code>```{r}</code> 和 <code>```</code>。</p></li>
</ol>
<p>我们建议你学习键盘快捷键。从长远来看，它会为你节省大量时间！</p>
<p>你可以继续使用你现在（我们希望！）已经熟知并喜爱的键盘快捷键来运行代码：Cmd/Ctrl + Enter。然而，代码块有了一个新的键盘快捷键：Cmd/Ctrl + Shift + Enter，它会运行代码块中的所有代码。把代码块想象成一个函数。一个代码块应该是相对独立的，并专注于一个单一的任务。</p>
<p>接下来的部分描述了代码块标头，它由 <code>```{r}</code> 组成，后面可以跟一个可选的代码块标签和各种其他的代码块选项，每个选项都在新的一行，并以 <code>#|</code> 开头。</p>
<section id="代码块标签" class="level3" data-number="28.5.1"><h3 data-number="28.5.1" class="anchored" data-anchor-id="代码块标签">
<span class="header-section-number">28.5.1</span> 代码块标签</h3>
<p>代码块可以有一个可选的标签，例如：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: simple-addition</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>#&gt; [1] 2</code></pre>
</div>
<p>这有三个优点：</p>
<ol type="1">
<li><p>你可以使用脚本编辑器左下角的下拉代码导航器更轻松地导航到特定的代码块：</p></li>
</ol>
<p>#| echo: false #| out-width: “30%” #| fig-alt: | #| RStudio IDE 的片段，仅显示下拉代码导航器， #| 其中显示了三个代码块。代码块 1 是 setup。代码块 2 是 cars， #| 它在一个名为 Quarto 的部分中。代码块 3 是 pressure， #| 它在一个名为“包含绘图”的部分中。 knitr::include_graphics(“screenshots/quarto-chunk-nav.png”) ```</p>
<ol start="2" type="1">
<li><p>由代码块生成的图形将具有有意义的名称，这使得它们在其他地方更容易使用。更多相关内容见 <a href="#sec-figures" class="quarto-xref"><span>Section 28.6</span></a>。</p></li>
<li><p>你可以建立缓存代码块的网络，以避免每次运行时都重新执行耗时的计算。更多相关内容见 <a href="#sec-caching" class="quarto-xref"><span>Section 28.8</span></a>。</p></li>
</ol>
<p>你的代码块标签应该简短但具有描述性，并且不应包含空格。我们建议使用破折号 (<code>-</code>) 来分隔单词（而不是下划线 <code>_</code>），并避免在代码块标签中使用其他特殊字符。</p>
<p>你通常可以自由地为你的代码块命名，但有一个代码块名称具有特殊行为：<code>setup</code>。当你在笔记模式下时，名为 <code>setup</code> 的代码块将在运行任何其他代码之前自动运行一次。</p>
<p>此外，代码块标签不能重复。每个代码块标签必须是唯一的。</p>
</section><section id="代码块选项" class="level3" data-number="28.5.2"><h3 data-number="28.5.2" class="anchored" data-anchor-id="代码块选项">
<span class="header-section-number">28.5.2</span> 代码块选项</h3>
<p>代码块的输出可以通过<strong>选项</strong>进行定制，这些选项是提供给代码块标头的字段。Knitr 提供了近 60 个选项，你可以用它们来定制你的代码块。在这里，我们将介绍你将频繁使用的最重要的代码块选项。你可以在 <a href="https://yihui.org/knitr/options/" class="uri">https://yihui.org/knitr/options</a> 查看完整列表。</p>
<p>最重要的一组选项控制你的代码块是否被执行，以及哪些结果会插入到最终的报告中：</p>
<ul>
<li><p><code>eval: false</code> 阻止代码被执行。（显然，如果代码不运行，就不会生成任何结果）。这对于显示示例代码，或者在不注释掉每一行的情况下禁用一大块代码很有用。</p></li>
<li><p><code>include: false</code> 运行代码，但不在最终文档中显示代码或结果。可用于你不想让报告变得杂乱的设置代码。</p></li>
<li><p><code>echo: false</code> 阻止代码（而不是结果）出现在最终文件中。当编写面向不希望看到底层 R 代码的人的报告时，请使用此选项。</p></li>
<li><p><code>message: false</code> 或 <code>warning: false</code> 阻止消息或警告出现在最终文件中。</p></li>
<li><p><code>results: hide</code> 隐藏打印输出；<code>fig-show: hide</code> 隐藏绘图。</p></li>
<li><p><code>error: true</code> 即使代码返回错误，也会让渲染继续进行。这很少是你想要包含在报告最终版本中的东西，但如果你需要精确调试 <code>.qmd</code> 文件内部发生了什么，它可能非常有用。如果你正在教 R 并且想故意包含一个错误，它也很有用。默认值 <code>error: false</code> 会在文档中出现单个错误时导致渲染失败。</p></li>
</ul>
<p>这些代码块选项中的每一个都被添加到代码块的标头中，跟在 <code>#|</code> 之后。例如，在下面的代码块中，结果不会被打印，因为 <code>eval</code> 被设置为 <code>false</code>。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: simple-multiplication</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>下表总结了每个选项抑制了哪些类型的输出：</p>
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;">选项</th>
<th style="text-align: center;">运行代码</th>
<th style="text-align: center;">显示代码</th>
<th style="text-align: center;">输出</th>
<th style="text-align: center;">绘图</th>
<th style="text-align: center;">消息</th>
<th style="text-align: center;">警告</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>eval: false</code></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>include: false</code></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">X</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>echo: false</code></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>results: hide</code></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fig-show: hide</code></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>message: false</code></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>warning: false</code></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">X</td>
</tr>
</tbody>
</table></section><section id="全局选项" class="level3" data-number="28.5.3"><h3 data-number="28.5.3" class="anchored" data-anchor-id="全局选项">
<span class="header-section-number">28.5.3</span> 全局选项</h3>
<p>随着你更多地使用 knitr，你会发现一些默认的代码块选项不符合你的需求，你想要更改它们。</p>
<p>你可以在文档的 YAML 中，在 <code>execute</code> 下添加你偏好的选项来做到这一点。例如，如果你正在为一群不需要看到你的代码，只需要你的结果和叙述的观众准备报告，你可以在文档级别设置 <code>echo: false</code>。这将默认隐藏代码，因此只显示你特意选择显示的代码块（使用 <code>echo: true</code>）。你可能会考虑设置 <code>message: false</code> 和 <code>warning: false</code>，但这会使调试问题变得更加困难，因为你在最终文档中看不到任何消息。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"我的报告"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">execute</span><span class="kw">:</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">echo</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>由于 Quarto 被设计为多语言的（可与 R 以及 Python、Julia 等其他语言一起工作），所以并非所有的 knitr 选项都在文档执行级别可用，因为其中一些只适用于 knitr，而不适用于 Quarto 用于在其他语言中运行代码的其他引擎（例如 Jupyter）。然而，你仍然可以在 <code>knitr</code> 字段下的 <code>opts_chunk</code> 中将它们设置为文档的全局选项。例如，在编写书籍和教程时，我们设置：</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"教程"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">knitr</span><span class="kw">:</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">opts_chunk</span><span class="kw">:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">comment</span><span class="kw">:</span><span class="at"> </span><span class="st">"#&gt;"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">collapse</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>这使用了我们偏好的注释格式，并确保代码和输出紧密地结合在一起。</p>
</section><section id="内联代码" class="level3" data-number="28.5.4"><h3 data-number="28.5.4" class="anchored" data-anchor-id="内联代码">
<span class="header-section-number">28.5.4</span> 内联代码</h3>
<p>还有另一种将 R 代码嵌入到 Quarto 文档中的方法：直接嵌入文本中，使用：<code>`r `</code>。如果你在文本中提到数据的属性，这会非常有用。例如，本章开头使用的示例文档中有：</p>
<blockquote class="blockquote">
<p>我们有关于 <code>`r nrow(diamonds)`</code> 颗钻石的数据。 只有 <code>`r nrow(diamonds) - nrow(smaller)`</code> 颗钻石大于 2.5 克拉。 剩余部分的分布如下所示：</p>
</blockquote>
<p>当报告被渲染时，这些计算的结果会被插入到文本中：</p>
<blockquote class="blockquote">
<p>我们有关于 53940 颗钻石的数据。 只有 126 颗钻石大于 2.5 克拉。 剩余部分的分布如下所示：</p>
</blockquote>
<p>在文本中插入数字时，<code><a href="https://rdrr.io/r/base/format.html">format()</a></code> 是你的好帮手。它允许你设置 <code>digits</code> 的数量，这样你就不会打印出精度高到离谱的数字，还可以设置 <code>big.mark</code> 使数字更容易阅读。你可能会将这些组合成一个辅助函数：</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">comma</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">x</span>, digits <span class="op">=</span> <span class="fl">2</span>, big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span>
<span><span class="fu">comma</span><span class="op">(</span><span class="fl">3452345</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "3,452,345"</span></span>
<span><span class="fu">comma</span><span class="op">(</span><span class="fl">.12358124331</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "0.12"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="练习-3" class="level3" data-number="28.5.5"><h3 data-number="28.5.5" class="anchored" data-anchor-id="练习-3">
<span class="header-section-number">28.5.5</span> 练习</h3>
<ol type="1">
<li><p>添加一个部分，探讨钻石大小如何随切工、颜色和净度而变化。假设你正在为不懂 R 的人写报告，并且不要在每个代码块上设置 <code>echo: false</code>，而是设置一个全局选项。</p></li>
<li><p>从 <a href="https://github.com/hadley/r4ds/tree/main/quarto">https://github.com/hadley/r4ds/tree/main/quarto</a> 下载 <code>diamond-sizes.qmd</code>。添加一个描述最大的 20 颗钻石的部分，包括一个显示它们最重要属性的表格。</p></li>
<li><p>修改 <code>diamonds-sizes.qmd</code> 以使用 <code>label_comma()</code> 来生成格式精美的输出。同时，也包括大于 2.5 克拉的钻石的百分比。</p></li>
</ol></section></section><section id="sec-figures" class="level2" data-number="28.6"><h2 data-number="28.6" class="anchored" data-anchor-id="sec-figures">
<span class="header-section-number">28.6</span> 图形</h2>
<p>Quarto 文档中的图形可以是被嵌入的（例如，一个 PNG 或 JPEG 文件），也可以是代码块运行的结果。</p>
<p>要嵌入一个外部文件中的图像，你可以在 RStudio 的可视化编辑器中使用“Insert”菜单，然后选择“Figure / Image”。这将弹出一个菜单，你可以在其中浏览到你想要插入的图像，并为其添加替代文本或标题，以及调整其大小。在可视化编辑器中，你也可以简单地将剪贴板中的图像粘贴到你的文档中，RStudio 会将该图像的副本放置在你的项目文件夹中。</p>
<p>如果你包含一个生成图形的代码块（例如，包含一个 <code>ggplot()</code> 调用），生成的图形将自动包含在你的 Quarto 文档中。</p>
<section id="图形尺寸" class="level3" data-number="28.6.1"><h3 data-number="28.6.1" class="anchored" data-anchor-id="图形尺寸">
<span class="header-section-number">28.6.1</span> 图形尺寸</h3>
<p>在 Quarto 中，图形最大的挑战是让你的图形获得正确的尺寸和形状。有五个主要的选项控制图形尺寸：<code>fig-width</code>、<code>fig-height</code>、<code>fig-asp</code>、<code>out-width</code> 和 <code>out-height</code>。图像尺寸之所以具有挑战性，是因为有两个尺寸（R 创建的图形的尺寸和它在输出文档中插入的尺寸），并且有多种指定尺寸的方式（即高度、宽度和纵横比：三选二）。</p>
<p>我们推荐使用这五个选项中的三个：</p>
<ul>
<li><p>如果图形具有一致的宽度，它们往往在美学上更令人愉悦。为了实现这一点，请在默认设置中设置 <code>fig-width: 6</code>（6英寸）和 <code>fig-asp: 0.618</code>（黄金比例）。然后在单个代码块中，只调整 <code>fig-asp</code>。</p></li>
<li>
<p>使用 <code>out-width</code> 控制输出尺寸，并将其设置为输出文档正文宽度的百分比。我们建议 <code>out-width: "70%"</code> 和 <code>fig-align: center</code>。</p>
<p>这给绘图留出了呼吸的空间，而不会占用太多空间。</p>
</li>
<li><p>要将多个绘图放在一行中，请为两个绘图设置 <code>layout-ncol</code> 为 2，为三个绘图设置 <code>layout-ncol</code> 为 3，依此类推。如果 <code>layout-ncol</code> 是 2，这实际上会将每个绘图的 <code>out-width</code> 设置为 “50%”；如果 <code>layout-ncol</code> 是 3，则为 “33%”，依此类推。根据你试图说明的内容（例如，显示数据或显示绘图变体），你可能还需要调整 <code>fig-width</code>，如下所述。</p></li>
</ul>
<p>如果你发现你需要眯着眼睛才能看清绘图中的文字，你需要调整 <code>fig-width</code>。如果 <code>fig-width</code> 大于图形在最终文档中渲染的尺寸，文字就会太小；如果 <code>fig-width</code> 小于最终尺寸，文字就会太大。你通常需要做一些实验来找出 <code>fig-width</code> 和文档中最终宽度之间的正确比例。为了说明这个原理，下面三个绘图的 <code>fig-width</code> 分别是 4、6 和 8：</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="quarto_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:50.0%" alt="汽车高速公路里程与排量的散点图，其中数据点 大小正常，坐标轴文本和标签的字体大小与周围文本相似。"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="quarto_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" style="width:50.0%" alt="汽车高速公路里程与排量的散点图，其中数据点 比前一个图小，坐标轴文本和标签也比周围文本小。"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="quarto_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" style="width:50.0%" alt="汽车高速公路里程与排量的散点图，其中数据点 比前一个图更小，坐标轴文本和标签也比周围文本更小。"></p>
</figure>
</div>
</div>
</div>
<p>如果你想确保所有图形的字体大小都一致，那么每当你设置 <code>out-width</code> 时，你都需要调整 <code>fig-width</code> 以保持与你的默认 <code>out-width</code> 相同的比例。例如，如果你的默认 <code>fig-width</code> 是 6，<code>out-width</code> 是 “70%”，那么当你设置 <code>out-width: "50%"</code> 时，你需要将 <code>fig-width</code> 设置为 4.3 (6 * 0.5 / 0.7)。</p>
<p>图形尺寸和缩放是一门艺术和科学，要做到恰到好处可能需要一个迭代的试错过程。你可以在 <a href="https://www.tidyverse.org/blog/2020/08/taking-control-of-plot-scaling/">这篇关于控制绘图缩放的博客文章</a> 中了解更多关于图形尺寸的信息。</p>
</section><section id="其他重要选项" class="level3" data-number="28.6.2"><h3 data-number="28.6.2" class="anchored" data-anchor-id="其他重要选项">
<span class="header-section-number">28.6.2</span> 其他重要选项</h3>
<p>当像本书这样将代码和文本混合在一起时，你可以设置 <code>fig-show: hold</code>，这样绘图就会在代码之后显示。这有一个令人愉悦的副作用，即迫使你用解释来打断大段的代码。</p>
<p>要为绘图添加标题，请使用 <code>fig-cap</code>。在 Quarto 中，这会将图形从内联变为“浮动”。</p>
<p>如果你正在生成 PDF 输出，默认的图形类型是 PDF。这是一个很好的默认设置，因为 PDF 是高质量的矢量图形。但是，如果你要显示数千个点，它们可能会产生非常大且速度慢的绘图。在这种情况下，设置 <code>fig-format: "png"</code> 来强制使用 PNG。它们的质量稍低，但会紧凑得多。</p>
<p>给生成图形的代码块命名是一个好主意，即使你不常给其他代码块加标签。代码块标签用于生成磁盘上图形的文件名，所以给你的代码块命名可以让你更容易地挑选出绘图并在其他情况下重用（例如，如果你想快速地将单个绘图放入一封电子邮件中）。</p>
</section><section id="练习-4" class="level3" data-number="28.6.3"><h3 data-number="28.6.3" class="anchored" data-anchor-id="练习-4">
<span class="header-section-number">28.6.3</span> 练习</h3>
<ol type="1">
<li>在可视化编辑器中打开 <code>diamond-sizes.qmd</code>，找到一张钻石的图片，复制它，然后粘贴到文档中。双击图片并添加一个标题。调整图片大小并渲染你的文档。观察图片是如何保存在你当前的工作目录中的。</li>
<li>编辑 <code>diamond-sizes.qmd</code> 中生成绘图的代码块的标签，使其以前缀 <code>fig-</code> 开头，并使用代码块选项 <code>fig-cap</code> 为图形添加一个标题。然后，编辑代码块上方的文本，使用“Insert &gt; Cross Reference”添加对该图形的交叉引用。</li>
<li>使用以下代码块选项更改图形的大小，一次一个，渲染你的文档，并描述图形是如何变化的。
<ol type="a">
<li><code>fig-width: 10</code></li>
<li><code>fig-height: 3</code></li>
<li><code>out-width: "100%"</code></li>
<li><code>out-width: "20%"</code></li>
</ol>
</li>
</ol></section></section><section id="表格" class="level2" data-number="28.7"><h2 data-number="28.7" class="anchored" data-anchor-id="表格">
<span class="header-section-number">28.7</span> 表格</h2>
<p>与图形类似，你可以在 Quarto 文档中包含两种类型的表格。它们可以是你直接在 Quarto 文档中创建的 markdown 表格（使用“Insert Table”菜单），也可以是代码块运行结果生成的表格。在本节中，我们将重点关注后者，即通过计算生成的表格。</p>
<p>默认情况下，Quarto 会像你在控制台中看到的那样打印数据框和矩阵：</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mtcars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;                    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></span>
<span><span class="co">#&gt; Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></span>
<span><span class="co">#&gt; Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></span>
<span><span class="co">#&gt; Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></span>
<span><span class="co">#&gt; Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>如果你希望数据以附加格式显示，可以使用 <code><a href="https://rdrr.io/pkg/knitr/man/kable.html">knitr::kable()</a></code> 函数。下面的代码生成了 <a href="#tbl-kable" class="quarto-xref">Table&nbsp;<span>28.1</span></a>。</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span>, <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-kable" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-kable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;28.1: 一个 knitr kable 表格。
</figcaption><div aria-describedby="tbl-kable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 26%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 7%">
<col style="width: 7%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">mpg</th>
<th style="text-align: right;">cyl</th>
<th style="text-align: right;">disp</th>
<th style="text-align: right;">hp</th>
<th style="text-align: right;">drat</th>
<th style="text-align: right;">wt</th>
<th style="text-align: right;">qsec</th>
<th style="text-align: right;">vs</th>
<th style="text-align: right;">am</th>
<th style="text-align: right;">gear</th>
<th style="text-align: right;">carb</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mazda RX4</td>
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">160</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.90</td>
<td style="text-align: right;">2.620</td>
<td style="text-align: right;">16.46</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mazda RX4 Wag</td>
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">160</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.90</td>
<td style="text-align: right;">2.875</td>
<td style="text-align: right;">17.02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Datsun 710</td>
<td style="text-align: right;">22.8</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">3.85</td>
<td style="text-align: right;">2.320</td>
<td style="text-align: right;">18.61</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hornet 4 Drive</td>
<td style="text-align: right;">21.4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">258</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">3.215</td>
<td style="text-align: right;">19.44</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hornet Sportabout</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">360</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">3.440</td>
<td style="text-align: right;">17.02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>阅读 <code><a href="https://rdrr.io/pkg/knitr/man/kable.html">?knitr::kable</a></code> 的文档，了解你可以用来自定义表格的其他方法。如果需要更深度的定制，可以考虑 <strong>gt</strong>、<strong>huxtable</strong>、<strong>reactable</strong>、<strong>kableExtra</strong>、<strong>xtable</strong>、<strong>stargazer</strong>、<strong>pander</strong>、<strong>tables</strong> 和 <strong>ascii</strong> 这些包。它们各自提供了一套从 R 代码返回格式化表格的工具。</p>
<section id="练习-5" class="level3" data-number="28.7.1"><h3 data-number="28.7.1" class="anchored" data-anchor-id="练习-5">
<span class="header-section-number">28.7.1</span> 练习</h3>
<ol type="1">
<li>在可视化编辑器中打开 <code>diamond-sizes.qmd</code>，插入一个代码块，并使用 <code><a href="https://rdrr.io/pkg/knitr/man/kable.html">knitr::kable()</a></code> 添加一个表格，显示 <code>diamonds</code> 数据框的前 5 行。</li>
<li>改用 <code><a href="https://gt.rstudio.com/reference/gt.html">gt::gt()</a></code> 显示同一个表格。</li>
<li>添加一个以前缀 <code>tbl-</code> 开头的代码块标签，并使用代码块选项 <code>tbl-cap</code> 为表格添加一个标题。然后，编辑代码块上方的文本，使用“Insert &gt; Cross Reference”添加对该表格的交叉引用。</li>
</ol></section></section><section id="sec-caching" class="level2" data-number="28.8"><h2 data-number="28.8" class="anchored" data-anchor-id="sec-caching">
<span class="header-section-number">28.8</span> 缓存</h2>
<p>通常情况下，每次渲染文档都是从一个完全干净的环境开始的。这对于可复现性来说非常好，因为它确保了你已经用代码捕捉到了每一个重要的计算。然而，如果你有一些计算需要很长时间，这可能会很痛苦。解决方案是 <code>cache: true</code>。</p>
<p>你可以在文档级别启用 Knitr 缓存，以缓存文档中所有计算的结果，使用标准的 YAML 选项：</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"我的文档"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">execute</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">cache</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>你也可以在代码块级别启用缓存，以缓存特定代码块中计算的结果：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 耗时计算的代码...</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>设置后，这会将代码块的输出保存到磁盘上一个特殊命名的文件中。在后续运行中，knitr 会检查代码是否已更改，如果未更改，它将重用缓存的结果。</p>
<p>缓存系统必须谨慎使用，因为默认情况下它只基于代码本身，而不是其依赖项。例如，在这里 <code>processed_data</code> 代码块依赖于 <code>raw-data</code> 代码块：</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: raw-data</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>rawdata <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"一个_非常_大的_文件.csv"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: processed_data</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>processed_data <span class="ot">&lt;-</span> rawdata <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(import_var)) <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_variable =</span> <span class="fu">complicated_transformation</span>(x, y, z))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>缓存 <code>processed_data</code> 代码块意味着如果 dplyr 管道被更改，它将被重新运行，但如果 <code>read_csv()</code> 调用发生更改，它将不会被重新运行。你可以使用 <code>dependson</code> 代码块选项来避免这个问题：</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: processed-data</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#| dependson: "raw-data"</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>processed_data <span class="ot">&lt;-</span> rawdata <span class="sc">|&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(import_var)) <span class="sc">|&gt;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_variable =</span> <span class="fu">complicated_transformation</span>(x, y, z))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>dependson</code> 应该包含一个字符向量，其中包含被缓存的代码块所依赖的<em>每一个</em>代码块。每当 knitr 检测到其依赖项之一发生更改时，它就会更新被缓存代码块的结果。</p>
<p>请注意，如果 <code>a_very_large_file.csv</code> 发生更改，代码块将不会更新，因为 knitr 缓存只跟踪 <code>.qmd</code> 文件内部的更改。如果你还想跟踪该文件的更改，可以使用 <code>cache.extra</code> 选项。这是一个任意的 R 表达式，当它发生更改时将使缓存失效。一个好用的函数是 <code><a href="https://rdrr.io/r/base/file.info.html">file.mtime()</a></code>：它返回文件的最后修改时间。然后你可以这样写：</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: raw-data</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache.extra: !expr file.mtime("a_very_large_file.csv")</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>rawdata <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"a_very_large_file.csv"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>我们采纳了 <a href="https://twitter.com/drob/status/738786604731490304">David Robinson</a> 的建议来命名这些代码块：每个代码块都以它创建的主要对象命名。这使得理解 <code>dependson</code> 规范变得更容易。</p>
<p>随着你的缓存策略变得越来越复杂，定期使用 <code><a href="https://rdrr.io/pkg/knitr/man/clean_cache.html">knitr::clean_cache()</a></code> 清除所有缓存是一个好主意。</p>
<section id="练习-6" class="level3" data-number="28.8.1"><h3 data-number="28.8.1" class="anchored" data-anchor-id="练习-6">
<span class="header-section-number">28.8.1</span> 练习</h3>
<ol type="1">
<li>建立一个代码块网络，其中 <code>d</code> 依赖于 <code>c</code> 和 <code>b</code>，而 <code>b</code> 和 <code>c</code> 都依赖于 <code>a</code>。让每个代码块打印 <code><a href="https://lubridate.tidyverse.org/reference/now.html">lubridate::now()</a></code>，设置 <code>cache: true</code>，然后验证你对缓存的理解。</li>
</ol></section></section><section id="故障排除" class="level2" data-number="28.9"><h2 data-number="28.9" class="anchored" data-anchor-id="故障排除">
<span class="header-section-number">28.9</span> 故障排除</h2>
<p>对 Quarto 文档进行故障排除可能具有挑战性，因为你不再处于交互式的 R 环境中，你需要学习一些新技巧。此外，错误可能是由于 Quarto 文档本身的问题，也可能是由于 Quarto 文档中的 R 代码问题。</p>
<p>在带有代码块的文档中，一个常见的错误是重复的代码块标签，如果你的工作流程涉及复制和粘贴代码块，这种情况尤其普遍。要解决此问题，你只需更改其中一个重复的标签即可。</p>
<p>如果错误是由于文档中的 R 代码引起的，你应该首先尝试在交互式会话中重现问题。重启 R，然后“Run all chunks”（运行所有代码块），可以从“Code”菜单下的“Run region”中选择，也可以使用键盘快捷键 Ctrl + Alt + R。如果幸运的话，这会重现问题，你就可以在交互式环境中找出问题所在。</p>
<p>如果这没有帮助，那么你的交互式环境和 Quarto 环境之间一定存在某些差异。你将需要系统地探索这些选项。最常见的差异是工作目录：Quarto 的工作目录是它所在的目录。通过在代码块中包含 <code><a href="https://rdrr.io/r/base/getwd.html">getwd()</a></code> 来检查工作目录是否如你所料。</p>
<p>接下来，集思广益，想出所有可能导致该错误的因素。你需要系统地检查它们在你的 R 会话和你的 Quarto 会话中是否相同。最简单的方法是在导致问题的代码块上设置 <code>error: true</code>，然后使用 <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> 和 <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> 来检查设置是否如你所料。</p>
</section><section id="yaml-标头" class="level2" data-number="28.10"><h2 data-number="28.10" class="anchored" data-anchor-id="yaml-标头">
<span class="header-section-number">28.10</span> YAML 标头</h2>
<p>你可以通过调整 YAML 标头的参数来控制许多其他“整个文档”的设置。你可能想知道 YAML 代表什么：它是 “YAML Ain’t Markup Language”（YAML 不是一种标记语言），旨在以一种易于人类读写的方式表示分层数据。Quarto 用它来控制输出的许多细节。在这里，我们将讨论三个方面：自包含文档、文档参数和参考文献。</p>
<section id="自包含" class="level3" data-number="28.10.1"><h3 data-number="28.10.1" class="anchored" data-anchor-id="自包含">
<span class="header-section-number">28.10.1</span> 自包含</h3>
<p>HTML 文档通常有许多外部依赖项（例如，图像、CSS 样式表、JavaScript 等），默认情况下，Quarto 会将这些依赖项放在与你的 <code>.qmd</code> 文件同目录下的一个 <code>_files</code> 文件夹中。如果你将 HTML 文件发布到托管平台（例如，QuartoPub，<a href="https://quartopub.com/">https://quartopub.com/</a>），这个目录中的依赖项会与你的文档一起发布，因此在已发布的报告中可用。但是，如果你想通过电子邮件将报告发送给同事，你可能更喜欢一个单一的、自包含的 HTML 文档，它嵌入了所有的依赖项。你可以通过指定 <code>embed-resources</code> 选项来做到这一点：</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span><span class="kw">:</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">html</span><span class="kw">:</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">embed-resources</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>生成的文件将是自包含的，因此它不需要任何外部文件，也不需要互联网访问即可由浏览器正确显示。</p>
</section><section id="参数" class="level3" data-number="28.10.2"><h3 data-number="28.10.2" class="anchored" data-anchor-id="参数">
<span class="header-section-number">28.10.2</span> 参数</h3>
<p>Quarto 文档可以包含一个或多个参数，其值可以在你渲染报告时设置。当你希望用不同的关键输入值重新渲染同一份报告时，参数非常有用。例如，你可能需要按分公司生成销售报告、按学生生成考试成绩，或者按国家生成人口统计摘要。要声明一个或多个参数，请使用 <code>params</code> 字段。</p>
<p>这个例子使用一个 <code>my_class</code> 参数来决定显示哪一类汽车：</p>
<div class="cell">
<pre><code>---
format: html
params:
  my_class: "suv"
---

```{r}
#| label: setup
#| include: false

library(tidyverse)

class &lt;- mpg |&gt; filter(class == params$my_class)
```

# Fuel economy for `r params$my_class`s

```{r}
#| message: false

ggplot(class, aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth(se = FALSE)
```</code></pre>
</div>
<p>如你所见，参数在代码块中作为一个名为 <code>params</code> 的只读列表可用。</p>
<p>你可以将原子向量直接写入 YAML 标头。你也可以通过在参数值前加上 <code>!expr</code> 来运行任意 R 表达式。这是指定日期/时间参数的好方法。</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">params</span><span class="kw">:</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">start</span><span class="kw">:</span><span class="at"> !expr lubridate::ymd("2015-01-01")</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">snapshot</span><span class="kw">:</span><span class="at"> !expr lubridate::ymd_hms("2015-01-01 12:30:00")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section><section id="参考文献和引文" class="level3" data-number="28.10.3"><h3 data-number="28.10.3" class="anchored" data-anchor-id="参考文献和引文">
<span class="header-section-number">28.10.3</span> 参考文献和引文</h3>
<p>Quarto 可以自动生成多种样式的引文和参考文献。在 Quarto 文档中添加引文和参考文献最直接的方法是使用 RStudio 中的可视化编辑器。</p>
<p>要使用可视化编辑器添加引文，请转到“Insert &gt; Citation”。可以从多种来源插入引文：</p>
<ol type="1">
<li><p><a href="https://quarto.org/docs/visual-editor/technical.html#citations-from-dois">DOI</a> (文档对象标识符) 引用。</p></li>
<li><p><a href="https://quarto.org/docs/visual-editor/technical.html#citations-from-zotero">Zotero</a> 个人或小组文献库。</p></li>
<li><p>搜索 <a href="https://www.crossref.org/">Crossref</a>、<a href="https://datacite.org/">DataCite</a> 或 <a href="https://pubmed.ncbi.nlm.nih.gov/">PubMed</a>。</p></li>
<li><p>你的文档参考文献（文档目录中的一个 <code>.bib</code> 文件）。</p></li>
</ol>
<p>在底层，可视化模式使用标准的 Pandoc markdown 表示法来表示引文（例如，<code>[@citation]</code>）。</p>
<p>如果你使用前三种方法之一添加引文，可视化编辑器将自动为你创建一个 <code>bibliography.bib</code> 文件，并将参考文献添加到其中。它还会在文档的 YAML 中添加一个 <code>bibliography</code> 字段。随着你添加更多的参考文献，这个文件将被它们的引文填充。你也可以直接使用许多常见的参考文献格式编辑此文件，包括 BibLaTeX、BibTeX、EndNote、Medline。</p>
<p>要在源代码编辑器中的 .qmd 文件内创建引文，请使用由 ‘@’ + 参考文献文件中的引文标识符组成的键。然后将引文放在方括号内。以下是一些示例：</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>用分号分隔多个引文：Blah blah <span class="co">[</span><span class="ot">@smith04; @doe99</span><span class="co">]</span>。</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>你可以在方括号内添加任意注释：</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>Blah blah <span class="co">[</span><span class="ot">参见 @doe99, pp. 33-35; 以及 @smith04, ch. 1</span><span class="co">]</span>。</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>去掉方括号以创建文内引文：@smith04 </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>说 blah，或者 @smith04 <span class="co">[</span><span class="ot">p. 33</span><span class="co">]</span> 说 blah。</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>在引文前添加一个 <span class="in">`-`</span> 来抑制作者的名字：</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>Smith 说 blah <span class="co">[</span><span class="ot">-@smith04</span><span class="co">]</span>。</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>当 Quarto 渲染你的文件时，它将在你的文档末尾构建并附加一个参考文献列表。该参考文献列表将包含你的参考文献文件中的每一个被引用的参考文献，但它不会包含一个章节标题。因此，通常的做法是在你的文件末尾为参考文献添加一个章节标题，例如 <code># 参考文献</code> 或 <code># Bibliography</code>。</p>
<p>你可以通过在 <code>csl</code> 字段中引用一个 CSL (citation style language) 文件来更改你的引文和参考文献的样式：</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bibliography</span><span class="kw">:</span><span class="at"> rmarkdown.bib</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">csl</span><span class="kw">:</span><span class="at"> apa.csl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>与 <code>bibliography</code> 字段一样，你的 csl 文件应包含文件的路径。这里我们假设 csl 文件与 .qmd 文件在同一个目录中。一个寻找常见参考文献样式 CSL 文件的好地方是 <a href="https://github.com/citation-style-language/styles">https://github.com/citation-style-language/styles</a>。</p>
</section></section><section id="工作流" class="level2" data-number="28.11"><h2 data-number="28.11" class="anchored" data-anchor-id="工作流">
<span class="header-section-number">28.11</span> 工作流</h2>
<p>早些时候，我们讨论了捕获 R 代码的基本工作流，即你在<em>控制台</em>中交互式地工作，然后在<em>脚本编辑器</em>中捕获有效的内容。Quarto 将控制台和脚本编辑器结合在一起，模糊了交互式探索和长期代码捕获之间的界限。你可以在一个代码块内快速迭代，用 Cmd/Ctrl + Shift + Enter 编辑和重新执行。当你满意时，你就可以继续前进，开始一个新的代码块。</p>
<p>Quarto 之所以重要，还因为它将文字和代码如此紧密地集成在一起。这使它成为一个很棒的<strong>分析笔记</strong>，因为它让你能够开发代码并记录你的想法。分析笔记与物理科学中的经典实验笔记有许多相同的目标。它：</p>
<ul>
<li><p>记录你做了什么以及为什么这么做。无论你的记忆力有多好，如果你不记录你所做的事情，总有一天你会忘记重要的细节。把它们写下来，这样你就不会忘记！</p></li>
<li><p>支持严谨的思考。如果你边做边记录你的想法，并持续反思它们，你更有可能得出一个强有力的分析。当最终你写下你的分析与他人分享时，这也为你节省了时间。</p></li>
<li><p>帮助他人理解你的工作。独自进行数据分析的情况很少，你通常会作为一个团队的一部分工作。实验笔记可以帮助你不仅分享你做了什么，还分享你为什么这么做给你的同事或实验室伙伴。</p></li>
</ul>
<p>许多关于有效使用实验笔记的好建议也可以转化为分析笔记。我们借鉴了自己的经验和 Colin Purrington 关于实验笔记的建议 (<a href="https://colinpurrington.com/tips/lab-notebooks">https://colinpurrington.com/tips/lab-notebooks</a>)，总结出以下几点提示：</p>
<ul>
<li><p>确保每个笔记都有一个描述性的标题，一个引人入胜的文件名，以及一个简要描述分析目标的第一段。</p></li>
<li>
<p>使用 YAML 标头的日期字段来记录你开始写笔记的日期：</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span><span class="kw">:</span><span class="at"> 2016-08-23</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>使用 ISO8601 YYYY-MM-DD 格式，这样就不会有歧义。即使你通常不这样写日期，也要使用它！</p>
</li>
<li><p>如果你在一个分析想法上花费了大量时间，结果却发现是个死胡同，不要删除它！写一个简短的说明，说明它为什么失败，并把它留在笔记里。这会帮助你在将来回到这个分析时避免重蹈覆辙。</p></li>
<li><p>一般来说，你最好在 R 之外进行数据录入。但如果你确实需要记录一小段数据，请使用 <code><a href="https://tibble.tidyverse.org/reference/tribble.html">tibble::tribble()</a></code> 清晰地把它列出来。</p></li>
<li><p>如果你在一个数据文件中发现错误，永远不要直接修改它，而是编写代码来纠正这个值。并解释你为什么要做这个修正。</p></li>
<li><p>在一天结束之前，确保你能渲染这个笔记。如果你在使用缓存，确保清除缓存。这将让你在代码还记忆犹新的时候修复任何问题。</p></li>
<li><p>如果你希望你的代码长期可复现（即你可以在下个月或明年回来运行它），你需要跟踪你的代码使用的包的版本。一个严谨的方法是使用 <strong>renv</strong>，<a href="https://rstudio.github.io/renv/index.html">https://rstudio.github.io/renv/index.html</a>，它将包存储在你的项目目录中。一个快速而粗略的技巧是包含一个运行 <code><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo()</a></code> 的代码块——这不能让你轻松地重现你今天的包，但至少你会知道它们曾经是什么样的。</p></li>
<li><p>在你的职业生涯中，你将会创建非常非常多的分析笔记。你将如何组织它们，以便将来能再次找到它们？我们建议将它们存储在各自的项目中，并想出一个好的命名方案。</p></li>
</ul></section><section id="总结" class="level2" data-number="28.12"><h2 data-number="28.12" class="anchored" data-anchor-id="总结">
<span class="header-section-number">28.12</span> 总结</h2>
<p>在本章中，我们向你介绍了 Quarto，这是一个用于创作和发布可复现计算文档的工具，它将你的代码和文字说明整合在一处。你学习了如何在 RStudio 中使用可视化或源代码编辑器编写 Quarto 文档，代码块如何工作以及如何为它们自定义选项，如何在你的 Quarto 文档中包含图形和表格，以及为计算进行缓存的选项。此外，你还学习了如何调整 YAML 标头选项来创建自包含或参数化的文档，以及如何包含引文和参考文献。我们还为你提供了一些故障排除和工作流的技巧。</p>
<p>虽然这个介绍应该足以让你开始使用 Quarto，但仍有许多东西需要学习。Quarto 还相对年轻，并且仍在快速发展。了解其创新的最佳去处是 Quarto 的官方网站：<a href="https://quarto.org/" class="uri">https://quarto.org</a>。</p>
<p>我们在这里没有涉及两个重要的主题：协作以及如何准确地将你的想法传达给其他人的细节。协作是现代数据科学的重要组成部分，通过使用像 Git 和 GitHub 这样的版本控制工具，你可以让你的生活轻松得多。我们推荐由 Jenny Bryan 编写的 “Happy Git with R”，这是一本面向 R 用户的 Git 和 GitHub 用户友好入门读物。该书可在线免费获取：<a href="https://happygitwithr.com">https://happygitwithr.com</a>。</p>
<p>我们也没有谈及为了清晰地传达你的分析结果，你到底应该写些什么。为了提高你的写作水平，我们强烈推荐阅读 Joseph M. Williams &amp; Joseph Bizup 的 <a href="https://www.amazon.com/Style-Lessons-Clarity-Grace-12th/dp/0134080416"><em>Style: Lessons in Clarity and Grace</em></a> 或 George Gopen 的 <a href="https://www.amazon.com/Sense-Structure-Writing-Readers-Perspective/dp/0205296327"><em>The Sense of Structure: Writing from the Reader’s Perspective</em></a>。这两本书都将帮助你理解句子和段落的结构，并为你提供使你的写作更清晰的工具。（这些书如果买新的会相当昂贵，但许多英语课程都在使用它们，所以有很多便宜的二手书）。George Gopen 也在 <a href="https://www.georgegopen.com/litigation-articles.html">https://www.georgegopen.com/litigation-articles.html</a> 上发表了一些关于写作的短文。它们是针对律师的，但几乎所有内容也同样适用于数据科学家。</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/ggvispro\.github\.io\/r4ds-cn\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./communicate.html" class="pagination-link" aria-label="沟通">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">沟通</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./quarto-formats.html" class="pagination-link" aria-label="Quarto 格式">
        <span class="nav-page-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Quarto 格式</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ggvisPro/r4ds-cn/edit/main/quarto.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ggvisPro/r4ds-cn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>