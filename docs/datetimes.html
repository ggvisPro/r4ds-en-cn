<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hadley Wickham, Mine Çetinkaya-Rundel, and Garrett Grolemund">
<title>17&nbsp; 日期和时间 – R 数据科学 2e
（中文版）</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./missing-values.html" rel="next">
<link href="./factors.html" rel="prev">
<link href="./cover.jpg" rel="icon" type="image/jpeg">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-cfa698a38273543b64ee69d493127e2a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script defer="" data-domain="r4ds.hadley.nz" src="https://plausible.io/js/plausible.js"></script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./transform.html">数据转换</a></li><li class="breadcrumb-item"><a href="./datetimes.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">日期和时间</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R 数据科学 2e （中文版）</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ggvisPro/r4ds-cn/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">欢迎</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface-2e.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">第 2 版前言</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">引言</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">全局概览</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-visualize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">数据可视化</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">工作流程：基础</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">数据转换</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-style.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">工作流：代码风格</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">数据整理</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">工作流：脚本和项目</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">数据导入</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">工作流：获取帮助</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./visualize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">可视化</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./layers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">图层</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">探索性数据分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">沟通</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">数据转换</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logicals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">逻辑向量</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">数值</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">字符串</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regexps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">正则表达式</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">因子</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datetimes.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">日期和时间</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missing-values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">缺失值</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">连接</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">导入</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spreadsheets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">电子表格</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./databases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">数据库</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./arrow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Arrow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rectangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">层级数据</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./webscraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">网络抓取</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./program.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">编程</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">函数</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iteration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">迭代</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./base-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Base R 实战指南</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./communicate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">沟通</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto-formats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Quarto 格式</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#%E5%BC%95%E8%A8%80" id="toc-引言" class="nav-link active" data-scroll-target="#%E5%BC%95%E8%A8%80"><span class="header-section-number">17.1</span> 引言</a>
  <ul class="collapse">
<li><a href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6" id="toc-前提条件" class="nav-link" data-scroll-target="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="header-section-number">17.1.1</span> 前提条件</a></li>
  </ul>
</li>
  <li>
<a href="#sec-creating-datetimes" id="toc-sec-creating-datetimes" class="nav-link" data-scroll-target="#sec-creating-datetimes"><span class="header-section-number">17.2</span> 创建日期/时间</a>
  <ul class="collapse">
<li><a href="#%E5%9C%A8%E5%AF%BC%E5%85%A5%E6%9C%9F%E9%97%B4" id="toc-在导入期间" class="nav-link" data-scroll-target="#%E5%9C%A8%E5%AF%BC%E5%85%A5%E6%9C%9F%E9%97%B4"><span class="header-section-number">17.2.1</span> 在导入期间</a></li>
  <li><a href="#%E4%BB%8E%E5%AD%97%E7%AC%A6%E4%B8%B2" id="toc-从字符串" class="nav-link" data-scroll-target="#%E4%BB%8E%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="header-section-number">17.2.2</span> 从字符串</a></li>
  <li><a href="#%E4%BB%8E%E5%8D%95%E4%B8%AA%E7%BB%84%E4%BB%B6" id="toc-从单个组件" class="nav-link" data-scroll-target="#%E4%BB%8E%E5%8D%95%E4%B8%AA%E7%BB%84%E4%BB%B6"><span class="header-section-number">17.2.3</span> 从单个组件</a></li>
  <li><a href="#%E4%BB%8E%E5%85%B6%E4%BB%96%E7%B1%BB%E5%9E%8B" id="toc-从其他类型" class="nav-link" data-scroll-target="#%E4%BB%8E%E5%85%B6%E4%BB%96%E7%B1%BB%E5%9E%8B"><span class="header-section-number">17.2.4</span> 从其他类型</a></li>
  <li><a href="#%E7%BB%83%E4%B9%A0" id="toc-练习" class="nav-link" data-scroll-target="#%E7%BB%83%E4%B9%A0"><span class="header-section-number">17.2.5</span> 练习</a></li>
  </ul>
</li>
  <li>
<a href="#%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E7%BB%84%E4%BB%B6" id="toc-日期时间组件" class="nav-link" data-scroll-target="#%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E7%BB%84%E4%BB%B6"><span class="header-section-number">17.3</span> 日期时间组件</a>
  <ul class="collapse">
<li><a href="#%E8%8E%B7%E5%8F%96%E7%BB%84%E4%BB%B6" id="toc-获取组件" class="nav-link" data-scroll-target="#%E8%8E%B7%E5%8F%96%E7%BB%84%E4%BB%B6"><span class="header-section-number">17.3.1</span> 获取组件</a></li>
  <li><a href="#%E5%8F%96%E6%95%B4" id="toc-取整" class="nav-link" data-scroll-target="#%E5%8F%96%E6%95%B4"><span class="header-section-number">17.3.2</span> 取整</a></li>
  <li><a href="#%E4%BF%AE%E6%94%B9%E7%BB%84%E4%BB%B6" id="toc-修改组件" class="nav-link" data-scroll-target="#%E4%BF%AE%E6%94%B9%E7%BB%84%E4%BB%B6"><span class="header-section-number">17.3.3</span> 修改组件</a></li>
  <li><a href="#%E7%BB%83%E4%B9%A0-1" id="toc-练习-1" class="nav-link" data-scroll-target="#%E7%BB%83%E4%B9%A0-1"><span class="header-section-number">17.3.4</span> 练习</a></li>
  </ul>
</li>
  <li>
<a href="#%E6%97%B6%E9%97%B4%E8%B7%A8%E5%BA%A6" id="toc-时间跨度" class="nav-link" data-scroll-target="#%E6%97%B6%E9%97%B4%E8%B7%A8%E5%BA%A6"><span class="header-section-number">17.4</span> 时间跨度</a>
  <ul class="collapse">
<li><a href="#%E6%97%B6%E9%95%BF-durations" id="toc-时长-durations" class="nav-link" data-scroll-target="#%E6%97%B6%E9%95%BF-durations"><span class="header-section-number">17.4.1</span> 时长 (Durations)</a></li>
  <li><a href="#%E5%91%A8%E6%9C%9F-periods" id="toc-周期-periods" class="nav-link" data-scroll-target="#%E5%91%A8%E6%9C%9F-periods"><span class="header-section-number">17.4.2</span> 周期 (Periods)</a></li>
  <li><a href="#sec-intervals" id="toc-sec-intervals" class="nav-link" data-scroll-target="#sec-intervals"><span class="header-section-number">17.4.3</span> 区间 (Intervals)</a></li>
  <li><a href="#%E7%BB%83%E4%B9%A0-2" id="toc-练习-2" class="nav-link" data-scroll-target="#%E7%BB%83%E4%B9%A0-2"><span class="header-section-number">17.4.4</span> 练习</a></li>
  </ul>
</li>
  <li><a href="#%E6%97%B6%E5%8C%BA" id="toc-时区" class="nav-link" data-scroll-target="#%E6%97%B6%E5%8C%BA"><span class="header-section-number">17.5</span> 时区</a></li>
  <li><a href="#%E6%80%BB%E7%BB%93" id="toc-总结" class="nav-link" data-scroll-target="#%E6%80%BB%E7%BB%93"><span class="header-section-number">17.6</span> 总结</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/ggvisPro/r4ds-cn/edit/main/datetimes.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ggvisPro/r4ds-cn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./transform.html">数据转换</a></li><li class="breadcrumb-item"><a href="./datetimes.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">日期和时间</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-dates-and-times" class="quarto-section-identifier"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">日期和时间</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="引言" class="level2" data-number="17.1"><h2 data-number="17.1" class="anchored" data-anchor-id="引言">
<span class="header-section-number">17.1</span> 引言</h2>
<p>本章将向你展示如何在 R 中处理日期和时间。乍一看，日期和时间似乎很简单。你在日常生活中一直在使用它们，并且它们似乎没有引起太多困惑。然而，你对日期和时间了解得越多，它们似乎就变得越复杂！</p>
<p>为了热身，请思考一下一年有多少天，一天有多少小时。你可能记得大多数年份有 365 天，但闰年有 366 天。你知道判断一年是否为闰年的完整规则吗<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>？一天中的小时数则不那么明显：大多数日子有 24 小时，但在使用夏令时 (Daylight Saving Time, DST) 的地方，每年有一天是 23 小时，另一天是 25 小时。</p>
<p>日期和时间之所以困难，是因为它们必须调和两种物理现象（地球的自转和它围绕太阳的公转）与一系列地缘政治现象，包括月份、时区和夏令时。本章不会教你关于日期和时间的每一个细节，但它会为你提供坚实的实践技能基础，帮助你应对常见的数据分析挑战。</p>
<p>我们将首先向你展示如何从各种输入创建日期时间，然后一旦你有了一个日期时间，你如何可以提取年、月、日等组成部分。接着，我们将深入探讨处理时间跨度的棘手话题，根据你的不同需求，时间跨度有多种形式。最后，我们将简要讨论时区带来的额外挑战。</p>
<section id="前提条件" class="level3" data-number="17.1.1"><h3 data-number="17.1.1" class="anchored" data-anchor-id="前提条件">
<span class="header-section-number">17.1.1</span> 前提条件</h3>
<p>本章将重点介绍 <strong>lubridate</strong> 包，它使得在 R 中处理日期和时间变得更加容易。自最新的 tidyverse 版本发布以来，lubridate 已成为核心 tidyverse 的一部分。我们还需要 <strong>nycflights13</strong> 来获取练习数据。</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="sec-creating-datetimes" class="level2" data-number="17.2"><h2 data-number="17.2" class="anchored" data-anchor-id="sec-creating-datetimes">
<span class="header-section-number">17.2</span> 创建日期/时间</h2>
<p>有三种类型的日期/时间数据指代一个时间点：</p>
<ul>
<li><p><strong>日期 (date)</strong>。Tibble 将其打印为 <code>&lt;date&gt;</code>。</p></li>
<li><p>一天中的<strong>时间 (time)</strong>。Tibble 将其打印为 <code>&lt;time&gt;</code>。</p></li>
<li><p><strong>日期时间 (date-time)</strong> 是日期加上时间：它唯一地标识了一个时间点（通常精确到秒）。Tibble 将其打印为 <code>&lt;dttm&gt;</code>。基础 R 称之为 POSIXct，但这名字并不上口。</p></li>
</ul>
<p>在本章中，我们将重点关注日期和日期时间，因为 R 没有用于存储时间的原生类。如果你需要一个，可以使用 <strong>hms</strong> 包。</p>
<p>你应该始终使用能满足你需求的最简单的数据类型。这意味着如果你可以使用日期而不是日期时间，你就应该这样做。日期时间要复杂得多，因为需要处理时区问题，我们将在本章末尾再回到这个问题。</p>
<p>要获取当前日期或日期时间，你可以使用 <code><a href="https://lubridate.tidyverse.org/reference/now.html">today()</a></code> 或 <code><a href="https://lubridate.tidyverse.org/reference/now.html">now()</a></code>：</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">today</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2025-07-10"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">now</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2025-07-10 11:34:09 CST"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>此外，以下各节描述了你可能创建日期/时间的四种方式：</p>
<ul>
<li>使用 readr 读取文件时。</li>
<li>从字符串。</li>
<li>从单独的日期时间组件。</li>
<li>从现有的日期/时间对象。</li>
</ul>
<section id="在导入期间" class="level3" data-number="17.2.1"><h3 data-number="17.2.1" class="anchored" data-anchor-id="在导入期间">
<span class="header-section-number">17.2.1</span> 在导入期间</h3>
<p>如果你的 CSV 文件包含 ISO8601 格式的日期或日期时间，你无需做任何事情；readr 会自动识别它：</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">csv</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">  date,datetime</span></span>
<span><span class="st">  2022-01-02,2022-01-02 05:12</span></span>
<span><span class="st">"</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">csv</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span><span class="co">#&gt;   date       datetime           </span></span>
<span><span class="co">#&gt;   &lt;date&gt;     &lt;dttm&gt;             </span></span>
<span><span class="co">#&gt; 1 2022-01-02 2022-01-02 05:12:00</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>如果你之前没有听说过 <strong>ISO8601</strong>，它是一个书写日期的国际标准<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>，其中日期的各个部分从大到小排列，并用 <code>-</code> 分隔。例如，在 ISO8601 中，2022 年 5 月 3 日写作 <code>2022-05-03</code>。ISO8601 日期也可以包含时间，其中小时、分钟和秒用 <code>:</code> 分隔，日期和时间部分用 <code>T</code> 或空格分隔。例如，你可以将 2022 年 5 月 3 日下午 4:26 写成 <code>2022-05-03 16:26</code> 或 <code>2022-05-03T16:26</code>。</p>
<p>对于其他日期时间格式，你需要使用 <code>col_types</code> 加上 <code><a href="https://readr.tidyverse.org/reference/parse_datetime.html">col_date()</a></code> 或 <code><a href="https://readr.tidyverse.org/reference/parse_datetime.html">col_datetime()</a></code> 以及一个日期时间格式。readr 使用的日期时间格式是许多编程语言通用的标准，用一个 <code>%</code> 后跟一个字符来描述日期组件。例如，<code>%Y-%m-%d</code> 指定一个由年、<code>-</code>、月（数字）、<code>-</code>、日组成的日期。表 <a href="#tbl-date-formats" class="quarto-xref">Table&nbsp;<span>17.1</span></a> 列出了所有选项。</p>
<div id="tbl-date-formats" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-date-formats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;17.1: readr 能理解的所有日期格式
</figcaption><div aria-describedby="tbl-date-formats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead><tr class="header">
<th>类型</th>
<th>代码</th>
<th>含义</th>
<th>示例</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>年</td>
<td><code>%Y</code></td>
<td>4 位数年份</td>
<td>2021</td>
</tr>
<tr class="even">
<td></td>
<td><code>%y</code></td>
<td>2 位数年份</td>
<td>21</td>
</tr>
<tr class="odd">
<td>月</td>
<td><code>%m</code></td>
<td>数字</td>
<td>2</td>
</tr>
<tr class="even">
<td></td>
<td><code>%b</code></td>
<td>缩写名称</td>
<td>Feb</td>
</tr>
<tr class="odd">
<td></td>
<td><code>%B</code></td>
<td>完整名称</td>
<td>February</td>
</tr>
<tr class="even">
<td>日</td>
<td><code>%d</code></td>
<td>一位或两位数</td>
<td>2</td>
</tr>
<tr class="odd">
<td></td>
<td><code>%e</code></td>
<td>两位数</td>
<td>02</td>
</tr>
<tr class="even">
<td>时间</td>
<td><code>%H</code></td>
<td>24 小时制小时</td>
<td>13</td>
</tr>
<tr class="odd">
<td></td>
<td><code>%I</code></td>
<td>12 小时制小时</td>
<td>1</td>
</tr>
<tr class="even">
<td></td>
<td><code>%p</code></td>
<td>AM/PM</td>
<td>pm</td>
</tr>
<tr class="odd">
<td></td>
<td><code>%M</code></td>
<td>分钟</td>
<td>35</td>
</tr>
<tr class="even">
<td></td>
<td><code>%S</code></td>
<td>秒</td>
<td>45</td>
</tr>
<tr class="odd">
<td></td>
<td><code>%OS</code></td>
<td>带小数的秒</td>
<td>45.35</td>
</tr>
<tr class="even">
<td></td>
<td><code>%Z</code></td>
<td>时区名称</td>
<td>America/Chicago</td>
</tr>
<tr class="odd">
<td></td>
<td><code>%z</code></td>
<td>与 UTC 的偏移量</td>
<td>+0800</td>
</tr>
<tr class="even">
<td>其他</td>
<td><code>%.</code></td>
<td>跳过一个非数字字符</td>
<td>:</td>
</tr>
<tr class="odd">
<td></td>
<td><code>%*</code></td>
<td>跳过任意数量的非数字字符</td>
<td></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>下面的代码展示了几个应用于一个非常模糊的日期的选项：</p>
<div class="cell" data-messages="false">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">csv</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">  date</span></span>
<span><span class="st">  01/02/15</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">csv</span>, col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_datetime.html">col_date</a></span><span class="op">(</span><span class="st">"%m/%d/%y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span><span class="co">#&gt;   date      </span></span>
<span><span class="co">#&gt;   &lt;date&gt;    </span></span>
<span><span class="co">#&gt; 1 2015-01-02</span></span>
<span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">csv</span>, col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_datetime.html">col_date</a></span><span class="op">(</span><span class="st">"%d/%m/%y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span><span class="co">#&gt;   date      </span></span>
<span><span class="co">#&gt;   &lt;date&gt;    </span></span>
<span><span class="co">#&gt; 1 2015-02-01</span></span>
<span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">csv</span>, col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_datetime.html">col_date</a></span><span class="op">(</span><span class="st">"%y/%m/%d"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span><span class="co">#&gt;   date      </span></span>
<span><span class="co">#&gt;   &lt;date&gt;    </span></span>
<span><span class="co">#&gt; 1 2001-02-15</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>请注意，无论你如何指定日期格式，一旦将其导入 R，它总是以相同的方式显示。</p>
<p>如果你使用 <code>%b</code> 或 <code>%B</code> 并且处理非英语日期，你还需要提供一个 <code><a href="https://readr.tidyverse.org/reference/locale.html">locale()</a></code>。请参阅 <code><a href="https://readr.tidyverse.org/reference/date_names.html">date_names_langs()</a></code> 中的内置语言列表，或使用 <code><a href="https://readr.tidyverse.org/reference/date_names.html">date_names()</a></code> 创建你自己的。</p>
</section><section id="从字符串" class="level3" data-number="17.2.2"><h3 data-number="17.2.2" class="anchored" data-anchor-id="从字符串">
<span class="header-section-number">17.2.2</span> 从字符串</h3>
<p>日期时间格式规范语言功能强大，但需要仔细分析日期格式。另一种方法是使用 lubridate 的辅助函数，这些函数在你指定了组件顺序后会尝试自动确定格式。要使用它们，请确定年、月、日在你的日期中出现的顺序，然后按相同的顺序排列 “y”、“m” 和 “d”。这就得到了将解析你日期的 lubridate 函数的名称。例如：</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2017-01-31"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2017-01-31"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">mdy</a></span><span class="op">(</span><span class="st">"January 31st, 2017"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2017-01-31"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">dmy</a></span><span class="op">(</span><span class="st">"31-Jan-2017"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2017-01-31"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd()</a></code> 和类似的函数创建日期。要创建一个日期时间，请在解析函数名称的末尾加上一个下划线和 “h”、“m”、“s” 中的一个或多个：</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2017-01-31 20:11:59"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2017-01-31 20:11:59 UTC"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">mdy_hm</a></span><span class="op">(</span><span class="st">"01/31/2017 08:01"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2017-01-31 08:01:00 UTC"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>你也可以通过提供一个时区来强制从一个日期创建一个日期时间：</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2017-01-31"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2017-01-31 UTC"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>这里我使用了 UTC<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> 时区，你可能也知道它是 GMT，即格林尼治标准时间 (Greenwich Mean Time)，是 0° 经度的时间<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>。它不使用夏令时，这使得计算起来稍微容易一些。</p>
</section><section id="从单个组件" class="level3" data-number="17.2.3"><h3 data-number="17.2.3" class="anchored" data-anchor-id="从单个组件">
<span class="header-section-number">17.2.3</span> 从单个组件</h3>
<p>有时，你不会有一个单一的字符串，而是将日期时间的各个组件分布在多个列中。这就是我们在 <code>flights</code> 数据中遇到的情况：</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">hour</span>, <span class="va">minute</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 5</span></span>
<span><span class="co">#&gt;    year month   day  hour minute</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2013     1     1     5     15</span></span>
<span><span class="co">#&gt; 2  2013     1     1     5     29</span></span>
<span><span class="co">#&gt; 3  2013     1     1     5     40</span></span>
<span><span class="co">#&gt; 4  2013     1     1     5     45</span></span>
<span><span class="co">#&gt; 5  2013     1     1     6      0</span></span>
<span><span class="co">#&gt; 6  2013     1     1     5     58</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>要从这类输入创建一个日期/时间，对日期使用 <code><a href="https://lubridate.tidyverse.org/reference/make_datetime.html">make_date()</a></code>，对日期时间使用 <code><a href="https://lubridate.tidyverse.org/reference/make_datetime.html">make_datetime()</a></code>：</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">hour</span>, <span class="va">minute</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>departure <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/make_datetime.html">make_datetime</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">hour</span>, <span class="va">minute</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 336,776 × 6</span></span>
<span><span class="co">#&gt;    year month   day  hour minute departure          </span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dttm&gt;             </span></span>
<span><span class="co">#&gt; 1  2013     1     1     5     15 2013-01-01 05:15:00</span></span>
<span><span class="co">#&gt; 2  2013     1     1     5     29 2013-01-01 05:29:00</span></span>
<span><span class="co">#&gt; 3  2013     1     1     5     40 2013-01-01 05:40:00</span></span>
<span><span class="co">#&gt; 4  2013     1     1     5     45 2013-01-01 05:45:00</span></span>
<span><span class="co">#&gt; 5  2013     1     1     6      0 2013-01-01 06:00:00</span></span>
<span><span class="co">#&gt; 6  2013     1     1     5     58 2013-01-01 05:58:00</span></span>
<span><span class="co">#&gt; # ℹ 336,770 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>让我们对 <code>flights</code> 中的四个时间列做同样的事情。这些时间的表示格式有点奇特，所以我们使用模运算来提取小时和分钟组件。一旦我们创建了日期时间变量，我们就专注于本章其余部分将要探讨的变量。</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">make_datetime_100</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">time</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://lubridate.tidyverse.org/reference/make_datetime.html">make_datetime</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">time</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">100</span>, <span class="va">time</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">flights_dt</span> <span class="op">&lt;-</span> <span class="va">flights</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dep_time</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">arr_time</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    dep_time <span class="op">=</span> <span class="fu">make_datetime_100</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">dep_time</span><span class="op">)</span>,</span>
<span>    arr_time <span class="op">=</span> <span class="fu">make_datetime_100</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">arr_time</span><span class="op">)</span>,</span>
<span>    sched_dep_time <span class="op">=</span> <span class="fu">make_datetime_100</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">sched_dep_time</span><span class="op">)</span>,</span>
<span>    sched_arr_time <span class="op">=</span> <span class="fu">make_datetime_100</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">sched_arr_time</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">origin</span>, <span class="va">dest</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"delay"</span><span class="op">)</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"time"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">flights_dt</span></span>
<span><span class="co">#&gt; # A tibble: 328,063 × 9</span></span>
<span><span class="co">#&gt;   origin dest  dep_delay arr_delay dep_time            sched_dep_time     </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;             </span></span>
<span><span class="co">#&gt; 1 EWR    IAH           2        11 2013-01-01 05:17:00 2013-01-01 05:15:00</span></span>
<span><span class="co">#&gt; 2 LGA    IAH           4        20 2013-01-01 05:33:00 2013-01-01 05:29:00</span></span>
<span><span class="co">#&gt; 3 JFK    MIA           2        33 2013-01-01 05:42:00 2013-01-01 05:40:00</span></span>
<span><span class="co">#&gt; 4 JFK    BQN          -1       -18 2013-01-01 05:44:00 2013-01-01 05:45:00</span></span>
<span><span class="co">#&gt; 5 LGA    ATL          -6       -25 2013-01-01 05:54:00 2013-01-01 06:00:00</span></span>
<span><span class="co">#&gt; 6 EWR    ORD          -4        12 2013-01-01 05:54:00 2013-01-01 05:58:00</span></span>
<span><span class="co">#&gt; # ℹ 328,057 more rows</span></span>
<span><span class="co">#&gt; # ℹ 3 more variables: arr_time &lt;dttm&gt;, sched_arr_time &lt;dttm&gt;, …</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>有了这些数据，我们可以可视化一年中出发时间的分布情况：</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_dt</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dep_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_freqpoly</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">86400</span><span class="op">)</span> <span class="co"># 86400 秒 = 1 天</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="datetimes_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" alt="一个频率多边形图，x 轴是出发时间（2013 年 1 月至 12 月）， y 轴是航班数量（0-1000）。该频率多边形按天分箱，因此你看到的是按天计算的航班数量时间序列。 该模式主要由周模式主导；周末的航班较少。 在 2 月初、7 月初、11 月末和 12 月末有几天航班数量出奇地少。" width="576"></p>
</figure>
</div>
</div>
</div>
<p>或者在一天之内：</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_dt</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">dep_time</span> <span class="op">&lt;</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fl">20130102</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dep_time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_freqpoly</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">600</span><span class="op">)</span> <span class="co"># 600 秒 = 10 分钟</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="datetimes_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" alt="一个频率多边形图，x 轴是出发时间（1 月 1 日早上 6 点到午夜）， y 轴是航班数量（0-17），按 10 分钟增量分箱。 由于变异性高，很难看出太多模式， 但大多数箱中有 8-12 个航班，并且在早上 6 点前和晚上 8 点后航班明显较少。" width="576"></p>
</figure>
</div>
</div>
</div>
<p>请注意，当你在数值上下文中使用日期时间（如在直方图中），1 表示 1 秒，所以 <code>binwidth</code> 为 86400 意味着一天。对于日期，1 表示 1 天。</p>
</section><section id="从其他类型" class="level3" data-number="17.2.4"><h3 data-number="17.2.4" class="anchored" data-anchor-id="从其他类型">
<span class="header-section-number">17.2.4</span> 从其他类型</h3>
<p>你可能想要在日期时间和日期之间切换。这是 <code><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime()</a></code> 和 <code><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date()</a></code> 的工作：</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">today</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2025-07-10 UTC"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">now</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2025-07-10"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>有时你会得到以距离“Unix 纪元”（1970-01-01）的数值偏移量表示的日期/时间。如果偏移量以秒为单位，使用 <code><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime()</a></code>；如果以天为单位，使用 <code><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date()</a></code>。</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime</a></span><span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1970-01-01 10:00:00 UTC"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_date</a></span><span class="op">(</span><span class="fl">365</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1980-01-01"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="练习" class="level3" data-number="17.2.5"><h3 data-number="17.2.5" class="anchored" data-anchor-id="练习">
<span class="header-section-number">17.2.5</span> 练习</h3>
<ol type="1">
<li>
<p>如果你解析一个包含无效日期的字符串会发生什么？</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2010-10-10"</span>, <span class="st">"bananas"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li><p><code><a href="https://lubridate.tidyverse.org/reference/now.html">today()</a></code> 的 <code>tzone</code> 参数有什么作用？为什么它很重要？</p></li>
<li>
<p>对于以下每一个日期时间，展示你将如何使用 readr 的列规范和 lubridate 函数来解析它。</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d1</span> <span class="op">&lt;-</span> <span class="st">"January 1, 2010"</span></span>
<span><span class="va">d2</span> <span class="op">&lt;-</span> <span class="st">"2015-Mar-07"</span></span>
<span><span class="va">d3</span> <span class="op">&lt;-</span> <span class="st">"06-Jun-2017"</span></span>
<span><span class="va">d4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"August 19 (2015)"</span>, <span class="st">"July 1 (2015)"</span><span class="op">)</span></span>
<span><span class="va">d5</span> <span class="op">&lt;-</span> <span class="st">"12/30/14"</span> <span class="co"># 2014 年 12 月 30 日</span></span>
<span><span class="va">t1</span> <span class="op">&lt;-</span> <span class="st">"1705"</span></span>
<span><span class="va">t2</span> <span class="op">&lt;-</span> <span class="st">"11:15:10.12 PM"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
</ol></section></section><section id="日期时间组件" class="level2" data-number="17.3"><h2 data-number="17.3" class="anchored" data-anchor-id="日期时间组件">
<span class="header-section-number">17.3</span> 日期时间组件</h2>
<p>既然你知道了如何将日期时间数据导入 R 的日期时间数据结构中，让我们来探索一下你可以用它们做什么。本节将重点介绍让你获取和设置单个组件的访问器函数。下一节将探讨日期时间的算术运算如何工作。</p>
<section id="获取组件" class="level3" data-number="17.3.1"><h3 data-number="17.3.1" class="anchored" data-anchor-id="获取组件">
<span class="header-section-number">17.3.1</span> 获取组件</h3>
<p>你可以使用访问器函数 <code><a href="https://lubridate.tidyverse.org/reference/year.html">year()</a></code>、<code><a href="https://lubridate.tidyverse.org/reference/month.html">month()</a></code>、<code><a href="https://lubridate.tidyverse.org/reference/day.html">mday()</a></code> (月中的天)、<code><a href="https://lubridate.tidyverse.org/reference/day.html">yday()</a></code> (年中的天)、<code><a href="https://lubridate.tidyverse.org/reference/day.html">wday()</a></code> (周中的天)、<code><a href="https://lubridate.tidyverse.org/reference/hour.html">hour()</a></code>、<code><a href="https://lubridate.tidyverse.org/reference/minute.html">minute()</a></code> 和 <code><a href="https://lubridate.tidyverse.org/reference/second.html">second()</a></code> 来提取日期的各个部分。这些函数实际上是 <code><a href="https://lubridate.tidyverse.org/reference/make_datetime.html">make_datetime()</a></code> 的反向操作。</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2026-07-08 12:34:56"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2026</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 7</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">mday</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8</span></span>
<span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">yday</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 189</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">wday</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>对于 <code><a href="https://lubridate.tidyverse.org/reference/month.html">month()</a></code> 和 <code><a href="https://lubridate.tidyverse.org/reference/day.html">wday()</a></code>，你可以设置 <code>label = TRUE</code> 来返回月份或星期几的缩写名称。设置 <code>abbr = FALSE</code> 来返回完整名称。</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">datetime</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 7月</span></span>
<span><span class="co">#&gt; 12 Levels: 1月 &lt; 2月 &lt; 3月 &lt; 4月 &lt; 5月 &lt; 6月 &lt; 7月 &lt; 8月 &lt; 9月 &lt; ... &lt; 12月</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">wday</a></span><span class="op">(</span><span class="va">datetime</span>, label <span class="op">=</span> <span class="cn">TRUE</span>, abbr <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 星期三</span></span>
<span><span class="co">#&gt; 7 Levels: 星期日 &lt; 星期一 &lt; 星期二 &lt; 星期三 &lt; 星期四 &lt; ... &lt; 星期六</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>我们可以使用 <code><a href="https://lubridate.tidyverse.org/reference/day.html">wday()</a></code> 看到，工作日起飞的航班比周末多：</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_dt</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>wday <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html">wday</a></span><span class="op">(</span><span class="va">dep_time</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wday</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="datetimes_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" alt="一个条形图，x 轴是星期几，y 轴是航班数量。 周一至周五的航班数量大致相同，约为 48,000 次，在一周中略有下降。 周日稍低（约 45,000 次），周六则低得多（约 38,000 次）。" width="576"></p>
</figure>
</div>
</div>
</div>
<p>我们还可以查看一小时内按分钟划分的平均出发延误。有一个有趣的模式：在 20-30 分钟和 50-60 分钟之间起飞的航班延误时间远低于该小时的其他时间！</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_dt</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>minute <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/minute.html">minute</a></span><span class="op">(</span><span class="va">dep_time</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">minute</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    avg_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dep_delay</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">minute</span>, y <span class="op">=</span> <span class="va">avg_delay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="datetimes_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" alt="一个折线图，x 轴是实际出发的分钟数（0-60），y 轴是平均延误时间（4-20）。 平均延误从 (0, 12) 开始，稳步增加到 (18, 20)，然后急剧下降，在约 23 分钟时达到最小值，延误为 9 分钟。 然后再次增加到 (17, 35)，并急剧减少到 (55, 4)。最后以增加到 (60, 9) 结束。" width="576"></p>
</figure>
</div>
</div>
</div>
<p>有趣的是，如果我们看<em>计划</em>出发时间，我们没有看到这么强的模式：</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sched_dep</span> <span class="op">&lt;-</span> <span class="va">flights_dt</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>minute <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/minute.html">minute</a></span><span class="op">(</span><span class="va">sched_dep_time</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">minute</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    avg_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">arr_delay</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sched_dep</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">minute</span>, y <span class="op">=</span> <span class="va">avg_delay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="datetimes_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" alt="一个折线图，x 轴是计划出发的分钟数（0-60），y 轴是平均延误时间（4-16）。 模式相对不明显，只有一个小小的迹象表明，平均延误在一小时内可能从 10 分钟减少到 8 分钟。" width="576"></p>
</figure>
</div>
</div>
</div>
<p>那么为什么我们在实际出发时间上看到了那种模式呢？嗯，就像许多由人类收集的数据一样，航班倾向于在“整点”出发时间起飞，存在着强烈的偏好，如 <a href="#fig-human-rounding" class="quarto-xref">Figure&nbsp;<span>17.1</span></a> 所示。每当你处理涉及人类判断的数据时，都要警惕这种模式！</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-human-rounding" class="quarto-float quarto-figure quarto-figure-center anchored" alt="一个折线图，x 轴是出发分钟（0-60），y 轴是航班数量（0-60000）。 大多数航班计划在整点（约 60,000）或半点（约 35,000）出发。 此外，几乎所有航班都计划在五的倍数分钟出发， 在 15、45 和 55 分钟时略多一些。 ">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-human-rounding-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="datetimes_files/figure-html/fig-human-rounding-1.png" class="img-fluid figure-img" alt="一个折线图，x 轴是出发分钟（0-60），y 轴是航班数量（0-60000）。 大多数航班计划在整点（约 60,000）或半点（约 35,000）出发。 此外，几乎所有航班都计划在五的倍数分钟出发， 在 15、45 和 55 分钟时略多一些。 " width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-human-rounding-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17.1: 一个频率多边形图，显示了每小时计划起飞的航班数量。 你可以看到对像 0 和 30 这样的整数时间点的强烈偏好，以及通常对五的倍数的时间点的偏好。
</figcaption></figure>
</div>
</div>
</div>
</section><section id="取整" class="level3" data-number="17.3.2"><h3 data-number="17.3.2" class="anchored" data-anchor-id="取整">
<span class="header-section-number">17.3.2</span> 取整</h3>
<p>绘制单个组件的另一种方法是将日期取整到附近的时间单位，使用 <code><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date()</a></code>、<code><a href="https://lubridate.tidyverse.org/reference/round_date.html">round_date()</a></code> 和 <code><a href="https://lubridate.tidyverse.org/reference/round_date.html">ceiling_date()</a></code>。每个函数都接受一个要调整的日期向量，然后是要向下取整 (floor)、向上取整 (ceiling) 或四舍五入的单位名称。例如，这使我们能够绘制每周的航班数量：</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_dt</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">dep_time</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">week</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="datetimes_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" alt="一个折线图，x 轴是周（2013 年 1 月至 12 月），y 轴是航班数量（2,000-7,000）。 从 2 月到 11 月，模式相当平稳，每周约有 7,000 个航班。 在年的第一周（约 4,500 个航班）和最后一周（约 2,500 个航班），航班数量要少得多。" width="576"></p>
</figure>
</div>
</div>
</div>
<p>你可以通过计算 <code>dep_time</code> 与当天最早时刻之间的差值，来展示一天中航班的分布情况：</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_dt</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dep_hour <span class="op">=</span> <span class="va">dep_time</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">dep_time</span>, <span class="st">"day"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dep_hour</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_freqpoly</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co">#&gt; Don't know how to automatically pick scale for object of type &lt;difftime&gt;.</span></span>
<span><span class="co">#&gt; Defaulting to continuous.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="datetimes_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" alt="一个折线图，x 轴是出发时间。单位是自午夜以来的秒数，所以很难解释。" width="576"></p>
</figure>
</div>
</div>
</div>
<p>计算一对日期时间之间的差值会得到一个 difftime 对象（更多内容见 <a href="#sec-intervals" class="quarto-xref"><span>Section 17.4.3</span></a>）。我们可以将其转换为 <code>hms</code> 对象，以获得更有用的 x 轴：</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_dt</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dep_hour <span class="op">=</span> <span class="fu">hms</span><span class="fu">::</span><span class="fu"><a href="https://hms.tidyverse.org/reference/hms.html">as_hms</a></span><span class="op">(</span><span class="va">dep_time</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">dep_time</span>, <span class="st">"day"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dep_hour</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_freqpoly</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">30</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="datetimes_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" alt="一个折线图，x 轴是出发时间（午夜到午夜），y 轴是航班数量（0 到 15,000）。 在凌晨 5 点之前几乎没有航班（<100）。然后航班数量迅速上升 到每小时 12,000 次，在上午 9 点达到峰值 15,000 次，然后在上午 10 点到下午 2 点之间下降到 每小时约 8,000 次。然后航班数量增加到 每小时约 12,000 次，直到晚上 8 点，之后再次迅速下降。" width="576"></p>
</figure>
</div>
</div>
</div>
</section><section id="修改组件" class="level3" data-number="17.3.3"><h3 data-number="17.3.3" class="anchored" data-anchor-id="修改组件">
<span class="header-section-number">17.3.3</span> 修改组件</h3>
<p>你也可以使用每个访问器函数来修改日期/时间的组件。这在数据分析中不常用，但在清理有明显错误日期的数据时可能很有用。</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">datetime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2026-07-08 12:34:56"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2026-07-08 12:34:56 UTC"</span></span>
<span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">2030</span></span>
<span><span class="va">datetime</span></span>
<span><span class="co">#&gt; [1] "2030-07-08 12:34:56 UTC"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">01</span></span>
<span><span class="va">datetime</span></span>
<span><span class="co">#&gt; [1] "2030-01-08 12:34:56 UTC"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/hour.html">hour</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/hour.html">hour</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="va">datetime</span></span>
<span><span class="co">#&gt; [1] "2030-01-08 13:34:56 UTC"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>或者，你也可以不修改现有变量，而是使用 <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code> 创建一个新的日期时间。这也允许你一步设置多个值：</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">datetime</span>, year <span class="op">=</span> <span class="fl">2030</span>, month <span class="op">=</span> <span class="fl">2</span>, mday <span class="op">=</span> <span class="fl">2</span>, hour <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2030-02-02 02:34:56 UTC"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>如果值过大，它们会“滚动”到下一个单位：</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2023-02-01"</span><span class="op">)</span>, mday <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2023-03-02"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2023-02-01"</span><span class="op">)</span>, hour <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2023-02-17 16:00:00 UTC"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="练习-1" class="level3" data-number="17.3.4"><h3 data-number="17.3.4" class="anchored" data-anchor-id="练习-1">
<span class="header-section-number">17.3.4</span> 练习</h3>
<ol type="1">
<li><p>一天中航班时间的分布如何随着年份的推移而变化？</p></li>
<li><p>比较 <code>dep_time</code>、<code>sched_dep_time</code> 和 <code>dep_delay</code>。它们是否一致？解释你的发现。</p></li>
<li><p>比较 <code>air_time</code> 与出发和到达之间的时间差。解释你的发现。（提示：考虑机场的位置。）</p></li>
<li><p>平均延误时间在一天中是如何变化的？你应该使用 <code>dep_time</code> 还是 <code>sched_dep_time</code>？为什么？</p></li>
<li><p>如果你想最小化延误的几率，应该选择星期几出发？</p></li>
<li><p>是什么使得 <code>diamonds$carat</code> 和 <code>flights$sched_dep_time</code> 的分布相似？</p></li>
<li><p>证实我们的假设：20-30 分钟和 50-60 分钟内航班的提早出发是由计划航班提早起飞造成的。提示：创建一个二元变量，告诉你一个航班是否延误。</p></li>
</ol></section></section><section id="时间跨度" class="level2" data-number="17.4"><h2 data-number="17.4" class="anchored" data-anchor-id="时间跨度">
<span class="header-section-number">17.4</span> 时间跨度</h2>
<p>接下来你将学习日期的算术运算，包括减法、加法和除法。在此过程中，你将学习到三个表示时间跨度的重要类：</p>
<ul>
<li>
<strong>durations</strong>（时长），表示精确的秒数。</li>
<li>
<strong>periods</strong>（周期），表示人类的单位，如周和月。</li>
<li>
<strong>intervals</strong>（区间），表示一个起点和一个终点。</li>
</ul>
<p>你如何在时长 (duration)、周期 (period) 和区间 (interval) 之间选择？一如既往，选择能解决你问题的最简单的数据结构。如果你只关心物理时间，使用时长；如果你需要加上人类的时间单位，使用周期；如果你需要计算一个跨度在人类单位中有多长，使用区间。</p>
<section id="时长-durations" class="level3" data-number="17.4.1"><h3 data-number="17.4.1" class="anchored" data-anchor-id="时长-durations">
<span class="header-section-number">17.4.1</span> 时长 (Durations)</h3>
<p>在 R 中，当你用一个日期减去另一个日期时，你会得到一个 difftime 对象：</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Hadley 多大了？</span></span>
<span><span class="va">h_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">today</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"1979-10-14"</span><span class="op">)</span></span>
<span><span class="va">h_age</span></span>
<span><span class="co">#&gt; Time difference of 16706 days</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>一个 <code>difftime</code> 类的对象记录了一个以秒、分钟、小时、天或周为单位的时间跨度。这种模糊性可能会让 difftime 的使用有些痛苦，所以 lubridate 提供了一个总是使用秒的替代方案：<strong>duration</strong>（时长）。</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as.duration.html">as.duration</a></span><span class="op">(</span><span class="va">h_age</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1443398400s (~45.74 years)"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Durations（时长）附带了一系列方便的构造函数：</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">dseconds</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "15s"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">dminutes</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "600s (~10 minutes)"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">dhours</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">24</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "43200s (~12 hours)" "86400s (~1 days)"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">ddays</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "0s"                "86400s (~1 days)"  "172800s (~2 days)"</span></span>
<span><span class="co">#&gt; [4] "259200s (~3 days)" "345600s (~4 days)" "432000s (~5 days)"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">dweeks</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1814400s (~3 weeks)"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">dyears</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "31557600s (~1 years)"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>时长总是以秒为单位记录时间跨度。更大的单位是通过将分钟、小时、天、周和年转换为秒来创建的：1 分钟 60 秒，1 小时 60 分钟，1 天 24 小时，1 周 7 天。更大的时间单位问题更多。一年使用一年中的“平均”天数，即 365.25 天。没有办法将一个月转换为时长，因为变数太多了。</p>
<p>你可以对时长进行加法和乘法运算：</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">dyears</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "63115200s (~2 years)"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">dyears</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">dweeks</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">dhours</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "38869200s (~1.23 years)"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>你可以将时长加到日期上或从日期中减去：</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tomorrow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">today</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">ddays</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">last_year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html">today</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">dyears</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>然而，因为时长代表的是一个精确的秒数，有时你可能会得到一个意想不到的结果：</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">one_am</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2026-03-08 01:00:00"</span>, tz <span class="op">=</span> <span class="st">"America/New_York"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">one_am</span></span>
<span><span class="co">#&gt; [1] "2026-03-08 01:00:00 EST"</span></span>
<span><span class="va">one_am</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">ddays</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2026-03-09 02:00:00 EDT"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>为什么 3 月 8 日凌晨 1 点之后的一天是 3 月 9 日凌晨 2 点？如果你仔细看日期，你可能还会注意到时区已经改变了。3 月 8 日只有 23 个小时，因为那天是夏令时开始的时候，所以如果我们加上一整天的秒数，我们最终会得到一个不同的时间。</p>
</section><section id="周期-periods" class="level3" data-number="17.4.2"><h3 data-number="17.4.2" class="anchored" data-anchor-id="周期-periods">
<span class="header-section-number">17.4.2</span> 周期 (Periods)</h3>
<p>为了解决这个问题，lubridate 提供了 <strong>periods</strong>（周期）。周期也是时间跨度，但没有固定的秒数长度，而是使用“人类”的时间单位，比如天和月。这使得它们能以更直观的方式工作：</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">one_am</span></span>
<span><span class="co">#&gt; [1] "2026-03-08 01:00:00 EST"</span></span>
<span><span class="va">one_am</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2026-03-09 01:00:00 EDT"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>和时长一样，周期也可以通过一些方便的构造函数创建。</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">hours</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">24</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "12H 0M 0S" "24H 0M 0S"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "7d 0H 0M 0S"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1m 0d 0H 0M 0S" "2m 0d 0H 0M 0S" "3m 0d 0H 0M 0S" "4m 0d 0H 0M 0S"</span></span>
<span><span class="co">#&gt; [5] "5m 0d 0H 0M 0S" "6m 0d 0H 0M 0S"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>你可以对周期进行加法和乘法运算：</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">10</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "60m 10d 0H 0M 0S"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">hours</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">minutes</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "50d 25H 2M 0S"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>当然，还可以把它们加到日期上。与时长相比，周期更可能做到你所期望的：</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 闰年</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">dyears</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2024-12-31 06:00:00 UTC"</span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">years</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2025-01-01"</span></span>
<span></span>
<span><span class="co"># 夏令时</span></span>
<span><span class="va">one_am</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html">ddays</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2026-03-09 02:00:00 EDT"</span></span>
<span><span class="va">one_am</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2026-03-09 01:00:00 EDT"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>让我们用周期来修正一个与我们航班日期有关的奇怪现象。一些飞机似乎在从纽约市起飞<em>之前</em>就到达了目的地。</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_dt</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">arr_time</span> <span class="op">&lt;</span> <span class="va">dep_time</span><span class="op">)</span> </span>
<span><span class="co">#&gt; # A tibble: 10,633 × 9</span></span>
<span><span class="co">#&gt;   origin dest  dep_delay arr_delay dep_time            sched_dep_time     </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;             </span></span>
<span><span class="co">#&gt; 1 EWR    BQN           9        -4 2013-01-01 19:29:00 2013-01-01 19:20:00</span></span>
<span><span class="co">#&gt; 2 JFK    DFW          59        NA 2013-01-01 19:39:00 2013-01-01 18:40:00</span></span>
<span><span class="co">#&gt; 3 EWR    TPA          -2         9 2013-01-01 20:58:00 2013-01-01 21:00:00</span></span>
<span><span class="co">#&gt; 4 EWR    SJU          -6       -12 2013-01-01 21:02:00 2013-01-01 21:08:00</span></span>
<span><span class="co">#&gt; 5 EWR    SFO          11       -14 2013-01-01 21:08:00 2013-01-01 20:57:00</span></span>
<span><span class="co">#&gt; 6 LGA    FLL         -10        -2 2013-01-01 21:20:00 2013-01-01 21:30:00</span></span>
<span><span class="co">#&gt; # ℹ 10,627 more rows</span></span>
<span><span class="co">#&gt; # ℹ 3 more variables: arr_time &lt;dttm&gt;, sched_arr_time &lt;dttm&gt;, …</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>这些是过夜航班。我们对出发和到达时间使用了相同的日期信息，但这些航班是在第二天到达的。我们可以通过给每个过夜航班的到达时间加上 <code>days(1)</code> 来修正这个问题。</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_dt</span> <span class="op">&lt;-</span> <span class="va">flights_dt</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    overnight <span class="op">=</span> <span class="va">arr_time</span> <span class="op">&lt;</span> <span class="va">dep_time</span>,</span>
<span>    arr_time <span class="op">=</span> <span class="va">arr_time</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="va">overnight</span><span class="op">)</span>,</span>
<span>    sched_arr_time <span class="op">=</span> <span class="va">sched_arr_time</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="va">overnight</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>现在我们所有的航班都遵守物理定律了。</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_dt</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">arr_time</span> <span class="op">&lt;</span> <span class="va">dep_time</span><span class="op">)</span> </span>
<span><span class="co">#&gt; # A tibble: 0 × 10</span></span>
<span><span class="co">#&gt; # ℹ 10 variables: origin &lt;chr&gt;, dest &lt;chr&gt;, dep_delay &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   arr_delay &lt;dbl&gt;, dep_time &lt;dttm&gt;, sched_dep_time &lt;dttm&gt;, …</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-intervals" class="level3" data-number="17.4.3"><h3 data-number="17.4.3" class="anchored" data-anchor-id="sec-intervals">
<span class="header-section-number">17.4.3</span> 区间 (Intervals)</h3>
<p><code>dyears(1) / ddays(365)</code> 返回什么？它不完全是 1，因为 <code><a href="https://lubridate.tidyverse.org/reference/duration.html">dyears()</a></code> 被定义为平均每年所含的秒数，也就是 365.25 天。</p>
<p><code>years(1) / days(1)</code> 返回什么？嗯，如果年份是 2015 年，它应该返回 365，但如果是 2016 年，它应该返回 366！lubridate 没有足够的信息来给出一个明确的答案。它所做的是给出一个估计值：</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">years</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 365.25</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>如果你想要一个更精确的度量，你将需要使用 <strong>interval</strong> (区间)。一个区间是一对开始和结束的日期时间，或者你可以把它看作是一个有起点的时长。</p>
<p>你可以通过 <code>start %--% end</code> 来创建一个区间：</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y2023</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2023-01-01"</span><span class="op">)</span> <span class="op"><a href="https://lubridate.tidyverse.org/reference/interval.html">%--%</a></span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span></span>
<span><span class="va">y2024</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2024-01-01"</span><span class="op">)</span> <span class="op"><a href="https://lubridate.tidyverse.org/reference/interval.html">%--%</a></span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">"2025-01-01"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y2023</span></span>
<span><span class="co">#&gt; [1] 2023-01-01 UTC--2024-01-01 UTC</span></span>
<span><span class="va">y2024</span></span>
<span><span class="co">#&gt; [1] 2024-01-01 UTC--2025-01-01 UTC</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>然后你可以用 <code><a href="https://lubridate.tidyverse.org/reference/period.html">days()</a></code> 来除它，以找出一年中包含多少天：</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y2023</span> <span class="op">/</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 365</span></span>
<span><span class="va">y2024</span> <span class="op">/</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html">days</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 366</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="练习-2" class="level3" data-number="17.4.4"><h3 data-number="17.4.4" class="anchored" data-anchor-id="练习-2">
<span class="header-section-number">17.4.4</span> 练习</h3>
<ol type="1">
<li><p>向一个刚开始学习 R 的人解释 <code>days(!overnight)</code> 和 <code>days(overnight)</code>。你需要知道的关键事实是什么？</p></li>
<li><p>创建一个日期向量，给出 2015 年每个月的第一天。创建一个日期向量，给出<em>当前</em>年份每个月的第一天。</p></li>
<li><p>编写一个函数，给定你的生日（作为日期），返回你的年龄（以年为单位）。</p></li>
<li><p>为什么 <code>(today() %--% (today() + years(1))) / months(1)</code> 不起作用？</p></li>
</ol></section></section><section id="时区" class="level2" data-number="17.5"><h2 data-number="17.5" class="anchored" data-anchor-id="时区">
<span class="header-section-number">17.5</span> 时区</h2>
<p>时区是一个极其复杂的话题，因为它与地缘政治实体相互作用。幸运的是，我们不需要深入了解所有细节，因为它们对数据分析并非都重要，但我们确实需要正面应对一些挑战。</p>
<p>第一个挑战是时区的日常名称往往是模棱两可的。例如，如果你是美国人，你可能熟悉 EST，即东部标准时间 (Eastern Standard Time)。然而，澳大利亚和加拿大也有 EST！为了避免混淆，R 使用国际标准的 IANA 时区。这些时区使用一致的命名方案 <code>{地区}/{位置}</code>，通常形式为 <code>{大洲}/{城市}</code> 或 <code>{大洋}/{城市}</code>。例如 “America/New_York”, “Europe/Paris” 和 “Pacific/Auckland”。</p>
<p>你可能会好奇为什么时区使用城市名称，而通常你认为时区是与一个国家或国家内的某个区域相关联的。这是因为 IANA 数据库必须记录数十年的时区规则。几十年来，国家名称（或分裂）变更相当频繁，但城市名称往往保持不变。另一个问题是，名称不仅需要反映当前的行为，还需要反映完整的历史。例如，“America/New_York” 和 “America/Detroit” 都有时区。这两个城市目前都使用东部标准时间，但在 1969-1972 年，密歇根州（底特律所在的州）没有遵循夏令时，所以它需要一个不同的名称。值得一读原始的时区数据库（可在 <a href="https://www.iana.org/time-zones">https://www.iana.org/time-zones</a> 获取），仅仅为了读一些这样的故事！</p>
<p>你可以用 <code><a href="https://rdrr.io/r/base/timezones.html">Sys.timezone()</a></code> 来查看 R 认为你当前的时区是什么：</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/timezones.html">Sys.timezone</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Asia/Shanghai"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>（如果 R 不知道，你会得到一个 <code>NA</code>。）</p>
<p>并用 <code><a href="https://rdrr.io/r/base/timezones.html">OlsonNames()</a></code> 查看所有时区名称的完整列表：</p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/timezones.html">OlsonNames</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 597</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/timezones.html">OlsonNames</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Africa/Abidjan"     "Africa/Accra"       "Africa/Addis_Ababa"</span></span>
<span><span class="co">#&gt; [4] "Africa/Algiers"     "Africa/Asmara"      "Africa/Asmera"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>在 R 中，时区是日期时间的一个属性，只控制打印显示。例如，下面这三个对象代表同一时刻：</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2024-06-01 12:00:00"</span>, tz <span class="op">=</span> <span class="st">"America/New_York"</span><span class="op">)</span></span>
<span><span class="va">x1</span></span>
<span><span class="co">#&gt; [1] "2024-06-01 12:00:00 EDT"</span></span>
<span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2024-06-01 18:00:00"</span>, tz <span class="op">=</span> <span class="st">"Europe/Copenhagen"</span><span class="op">)</span></span>
<span><span class="va">x2</span></span>
<span><span class="co">#&gt; [1] "2024-06-01 18:00:00 CEST"</span></span>
<span></span>
<span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="st">"2024-06-02 04:00:00"</span>, tz <span class="op">=</span> <span class="st">"Pacific/Auckland"</span><span class="op">)</span></span>
<span><span class="va">x3</span></span>
<span><span class="co">#&gt; [1] "2024-06-02 04:00:00 NZST"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>你可以用减法来验证它们是同一时间：</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x1</span> <span class="op">-</span> <span class="va">x2</span></span>
<span><span class="co">#&gt; Time difference of 0 secs</span></span>
<span><span class="va">x1</span> <span class="op">-</span> <span class="va">x3</span></span>
<span><span class="co">#&gt; Time difference of 0 secs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>除非另有说明，lubridate 总是使用 UTC。UTC（协调世界时）是科学界使用的标准时区，大致相当于 GMT（格林尼治标准时间）。它没有夏令时，这使其成为一个方便的计算表示。结合日期时间的运算，比如 <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>，通常会丢掉时区。在这种情况下，日期时间将以第一个元素的时区显示：</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span>, <span class="va">x3</span><span class="op">)</span></span>
<span><span class="va">x4</span></span>
<span><span class="co">#&gt; [1] "2024-06-01 12:00:00 EDT" "2024-06-01 12:00:00 EDT"</span></span>
<span><span class="co">#&gt; [3] "2024-06-01 12:00:00 EDT"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>你可以用两种方式改变时区：</p>
<ul>
<li>
<p>保持时间点不变，改变它的显示方式。当时间点是正确的，但你想要一个更自然的显示时，使用这种方式。</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x4a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/with_tz.html">with_tz</a></span><span class="op">(</span><span class="va">x4</span>, tzone <span class="op">=</span> <span class="st">"Australia/Lord_Howe"</span><span class="op">)</span></span>
<span><span class="va">x4a</span></span>
<span><span class="co">#&gt; [1] "2024-06-02 02:30:00 +1030" "2024-06-02 02:30:00 +1030"</span></span>
<span><span class="co">#&gt; [3] "2024-06-02 02:30:00 +1030"</span></span>
<span><span class="va">x4a</span> <span class="op">-</span> <span class="va">x4</span></span>
<span><span class="co">#&gt; Time differences in secs</span></span>
<span><span class="co">#&gt; [1] 0 0 0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>（这也说明了时区的另一个挑战：它们并非都是整数小时的偏移！）</p>
</li>
<li>
<p>改变底层的时间点。当一个时间点被标记了错误的时区，而你需要修正它时，使用这种方式。</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x4b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/force_tz.html">force_tz</a></span><span class="op">(</span><span class="va">x4</span>, tzone <span class="op">=</span> <span class="st">"Australia/Lord_Howe"</span><span class="op">)</span></span>
<span><span class="va">x4b</span></span>
<span><span class="co">#&gt; [1] "2024-06-01 12:00:00 +1030" "2024-06-01 12:00:00 +1030"</span></span>
<span><span class="co">#&gt; [3] "2024-06-01 12:00:00 +1030"</span></span>
<span><span class="va">x4b</span> <span class="op">-</span> <span class="va">x4</span></span>
<span><span class="co">#&gt; Time differences in hours</span></span>
<span><span class="co">#&gt; [1] -14.5 -14.5 -14.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
</ul></section><section id="总结" class="level2" data-number="17.6"><h2 data-number="17.6" class="anchored" data-anchor-id="总结">
<span class="header-section-number">17.6</span> 总结</h2>
<p>本章向你介绍了 lubridate 提供的帮助你处理日期时间数据的工具。处理日期和时间似乎比必要的要困难，但希望本章能帮助你理解原因——日期时间比初看起来要复杂得多，处理每一种可能的情况都增加了复杂性。即使你的数据从未跨越夏令时边界或涉及闰年，函数也需要能够处理这些情况。</p>
<p>下一章将总结缺失值。你已经在一些地方看到过它们，并且无疑在自己的分析中遇到过，现在是时候提供一系列处理它们的有用技巧了。</p>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>如果一个年份能被 4 整除，那么它就是闰年，除非它也能被 100 整除，但如果它同时能被 400 整除，那它仍然是闰年。换句话说，每 400 年中，有 97 个闰年。<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><a href="https://xkcd.com/1179/">https://xkcd.com/1179/</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>你可能会想 UTC 代表什么。它是英语 “Coordinated Universal Time”（协调世界时）和法语 “Temps Universel Coordonné” 之间的一个妥协。<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>猜猜是哪个国家提出了经度系统，没有奖品。<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/ggvispro\.github\.io\/r4ds-cn\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./factors.html" class="pagination-link" aria-label="因子">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">因子</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./missing-values.html" class="pagination-link" aria-label="缺失值">
        <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">缺失值</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ggvisPro/r4ds-cn/edit/main/datetimes.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/ggvisPro/r4ds-cn/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>